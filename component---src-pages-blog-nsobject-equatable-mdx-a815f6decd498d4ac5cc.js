(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{138:function(e,n,t){"use strict";t.r(n),t.d(n,"_frontmatter",function(){return p});var a=t(157),o=t.n(a),i=t(0),r=t.n(i),l=t(172),c=t(169),m=t(155);n.default=function(e){var n=e.components,t=o()(e,["components"]);return r.a.createElement(l.MDXTag,{name:"wrapper",Layout:c.a,layoutProps:t,components:n},r.a.createElement(m.b,{title:"NSObject Equality is Tricky",date:"November 13th, 2016"}),r.a.createElement(l.MDXTag,{name:"p",components:n},"Swift can be tricky sometimes. For example, what does the following print?"),r.a.createElement(l.MDXTag,{name:"pre",components:n},r.a.createElement(l.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-swift",metaString:""}},"class A: NSObject {\n  let x: Int\n\n  init(x: Int) {\n    self.x = x\n  }\n}\n\nfunc ==(left: A, right: A) -> Bool {\n  return left.x == right.x\n}\n\nprint(A(x: 1) == A(x: 1))\nprint([A(x: 1)] == [A(x: 1)])\n")),r.a.createElement(l.MDXTag,{name:"p",components:n},"Perhaps surprisingly, it's this:"),r.a.createElement(l.MDXTag,{name:"pre",components:n},r.a.createElement(l.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-nohighlight",metaString:""}},"true\nfalse // huh?!\n")),r.a.createElement(l.MDXTag,{name:"h3",components:n},"Equatable conformance is hard"),r.a.createElement(l.MDXTag,{name:"p",components:n},"Why does comparing two arrays with equal contents return false? It turns out that:"),r.a.createElement(l.MDXTag,{name:"ul",components:n},r.a.createElement(l.MDXTag,{name:"li",components:n,parentName:"ul"},"Array is bridged to NSArray"),r.a.createElement(l.MDXTag,{name:"li",components:n,parentName:"ul"},"NSArray doesn't declare a ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:n,parentName:"li"},"==(_:_:)")," function, so it falls back to NSObject's ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:n,parentName:"li"},"==(_:_:)"),", which calls ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:n,parentName:"li"},"isEqual")),r.a.createElement(l.MDXTag,{name:"li",components:n,parentName:"ul"},"NSArray's ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:n,parentName:"li"},"isEqual")," ",r.a.createElement(l.MDXTag,{name:"a",components:n,parentName:"li",props:{href:"https://github.com/apple/swift-corelibs-foundation/blob/0cbb3225660752987a6c2cf672886fca434d3b1d/Foundation/NSArray.swift#L310"}},"compares objects by casting to AnyHashable"))),r.a.createElement(l.MDXTag,{name:"p",components:n},"We can see that this is the problem by casting the objects to ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"AnyHashable")," before comparing them:"),r.a.createElement(l.MDXTag,{name:"pre",components:n},r.a.createElement(l.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-swift",metaString:""}},"print(A(x: 1) as AnyHashable == A(x: 1) as AnyHashable)\n")),r.a.createElement(l.MDXTag,{name:"pre",components:n},r.a.createElement(l.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-nohighlight",metaString:""}},"false\n")),r.a.createElement(l.MDXTag,{name:"p",components:n},"Apparently, doing this will use the NSObject implementation of ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"==(_:_:)")," rather than the ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"A")," one. The NSObject implementation of ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"==(_:_:)")," checks isEqual, which returns false because the two elements aren't the same in memory. We can see this by adding an override:"),r.a.createElement(l.MDXTag,{name:"pre",components:n},r.a.createElement(l.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-swift",metaString:""}},'class B: NSObject {\n  let x: Int\n\n  init(x: Int) {\n    self.x = x\n  }\n\n  override func isEqual(_ object: Any?) -> Bool {\n    print("isEqual for B")\n    return super.isEqual(object)\n  }\n}\n\nfunc ==(left: B, right: B) -> Bool {\n  print("== for B")\n  return left.x == right.x\n}\n')),r.a.createElement(l.MDXTag,{name:"p",components:n},"Then,"),r.a.createElement(l.MDXTag,{name:"pre",components:n},r.a.createElement(l.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-swift",metaString:""}},"print([B(x: 1)] == [B(x: 1)])\n")),r.a.createElement(l.MDXTag,{name:"pre",components:n},r.a.createElement(l.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-nohighlight",metaString:""}},"isEqual for B\nfalse\n")),r.a.createElement(l.MDXTag,{name:"h3",components:n},"The fix"),r.a.createElement(l.MDXTag,{name:"p",components:n},"As far as I can tell, the best way to make an NSObject subclass use custom equality inside an array is to override isEqual:"),r.a.createElement(l.MDXTag,{name:"pre",components:n},r.a.createElement(l.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-swift",metaString:""}},'class C: NSObject {\n  let x: Int\n\n  init(x: Int) {\n    self.x = x\n  }\n\n  override func isEqual(_ object: Any?) -> Bool {\n    guard let object = object as? C else { return false }\n    return object == self\n  }\n}\n\nfunc ==(left: C, right: C) -> Bool {\n  print("== for C")\n  return left.x == right.x\n}\n')),r.a.createElement(l.MDXTag,{name:"pre",components:n},r.a.createElement(l.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-swift",metaString:""}},"print([C(x: 1)] == [C(x: 1)])\n")),r.a.createElement(l.MDXTag,{name:"pre",components:n},r.a.createElement(l.MDXTag,{name:"code",components:n,parentName:"pre",props:{className:"language-nohighlight",metaString:""}},"== for C\ntrue\n")),r.a.createElement(l.MDXTag,{name:"p",components:n},"Of course, if we defined ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"A")," as a ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"struct")," or a regular ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"class")," in the first place, there won't be ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"==(_:_:)")," defined for ",r.a.createElement(l.MDXTag,{name:"inlineCode",components:n,parentName:"p"},"[A]"),", which means the compiler would catch our mistake instead of falling back to something that might not work correctly."),r.a.createElement(l.MDXTag,{name:"p",components:n},"Sigh. Working with NSObject can be tricky."),r.a.createElement(l.MDXTag,{name:"p",components:n},"A working playground with the code from this post can be found ",r.a.createElement(l.MDXTag,{name:"a",components:n,parentName:"p",props:{href:"https://github.com/noahsark769/code-examples/blob/ed9df41aae709eaeb4e334e3e9a5b1a650deef4d/swift/swift-nsobject-equatable.playground/Contents.swift"}},"here"),"."))};var p={}},144:function(e,n,t){"use strict";t.d(n,"c",function(){return u}),t.d(n,"b",function(){return h}),t.d(n,"e",function(){return x}),t.d(n,"d",function(){return b}),t.d(n,"a",function(){return E});var a=t(158),o=t.n(a),i=(t(0),t(143)),r=t(149),l=t.n(r),c=t(150),m=t.n(c),p=t(151),s=t.n(p),d=t(152),f=t.n(d);function g(){var e=o()(["\n    @font-face {\n        font-family: 'Bariol';\n        src: url('","');\n        src: url('","?#iefix') format('embedded-opentype'),\n             url('","') format('woff'),\n             url('","') format('truetype'),\n             url('","#svgBariolRegular') format('svg');\n    }\n\n    * {\n        box-sizing: border-box;\n    }\n"]);return g=function(){return e},e}var u=Object(i.a)(g(),l.a,l.a,m.a,s.a,f.a),h=i.c.div.withConfig({displayName:"default__Div",componentId:"d4l1a1-0"})([""]),x=(i.c.nav.withConfig({displayName:"default__Nav",componentId:"d4l1a1-1"})([""]),i.c.ul.withConfig({displayName:"default__UL",componentId:"d4l1a1-2"})(["margin:0;padding:0;"])),b=i.c.li.withConfig({displayName:"default__LI",componentId:"d4l1a1-3"})(["margin:0;padding:0;"]),E=i.c.a.withConfig({displayName:"default__A",componentId:"d4l1a1-4"})(["&,&:hover,&:focus{outline:none;color:inherit;text-decoration:none;}"])},149:function(e,n,t){e.exports=t.p+"static/Bariol-Regular-b0d07df351f442860551405a4be58de7.eot"},150:function(e,n,t){e.exports=t.p+"static/Bariol-Regular-4afd94f0fd93a1f63b46c6c6ad792f71.woff"},151:function(e,n,t){e.exports=t.p+"static/Bariol-Regular-8a7d23d53f8d118e190c63e4e81a91fe.ttf"},152:function(e,n,t){e.exports=t.p+"static/Bariol-Regular-75b90056f4cdf5a742897ec0a59569d7.svg"},154:function(e,n,t){"use strict";var a=t(0),o=t.n(a),i=t(144),r=t(143),l=r.c.nav.withConfig({displayName:"Nav__StyledNav",componentId:"sc-1cm9dpf-0"})(["display:flex;flex-direction:row;flex-wrap:wrap;padding:20px 60px;border-bottom:1px solid #ddd;@media all and (max-width:600px){flex-direction:column;padding:20px 20px 10px 20px;}"]),c=r.c.div.withConfig({displayName:"Nav__Title",componentId:"sc-1cm9dpf-1"})(['flex:2;font-family:"Roboto","Helvetica Neue","Helvetica",sans-serif;font-size:28px;']),m=Object(r.c)(i.e).withConfig({displayName:"Nav__NavLinks",componentId:"sc-1cm9dpf-2"})(["flex:10;display:flex;flex-direction:horizontal;flex-wrap:wrap;justify-content:flex-end;@media all and (max-width:600px){justify-content:flex-start;}"]),p=Object(r.c)(i.d).withConfig({displayName:"Nav__NavLink",componentId:"sc-1cm9dpf-3"})(['display:flex;flex-direction:horizontal;text-align:center;font-family:"Bariol","Helvetica Neue","Helvetica",sans-serif;font-size:16px;padding:0px 20px;@media all and (max-width:600px){display:block;width:100%;font-size:20px;margin:5px 0px;padding:10px 10px;background-color:#eee;}']),s=Object(r.c)(i.a).withConfig({displayName:"Nav__StyledA",componentId:"sc-1cm9dpf-4"})(["height:auto;color:rgba(128,165,177,1);&:hover{color:rgba(151,195,210,1);}@media all and (max-width:600px){width:100%;}"]);n.a=function(e){return o.a.createElement(l,null,o.a.createElement(c,null,"NOAH GILMORE"),o.a.createElement(m,null,o.a.createElement(p,null,o.a.createElement(s,{href:"/"},"HOME")),o.a.createElement(p,null,o.a.createElement(s,{href:"/blog/"},"POSTS"))))}},155:function(e,n,t){"use strict";t.d(n,"a",function(){return m}),t.d(n,"b",function(){return f});var a=t(7),o=t.n(a),i=t(0),r=t.n(i),l=(t(144),t(156),t(143)),c=t(146),m=l.c.div.withConfig({displayName:"BlogPost__BlogPostContainer",componentId:"gyfnna-0"})(["padding:60px 0;margin:0 auto;width:90%;@media all and (min-width:600px){max-width:700px;margin:auto;}"]),p=l.c.div.withConfig({displayName:"BlogPost__TitleContainer",componentId:"gyfnna-1"})(["width:100%;margin-bottom:40px;"]),s=l.c.h1.withConfig({displayName:"BlogPost__Heading",componentId:"gyfnna-2"})(['width:100%;font-family:"Roboto","Helvetica Neue","Helvetica",sans-serif;font-size:28px;margin-bottom:10px;']),d=l.c.p.withConfig({displayName:"BlogPost__DateContainer",componentId:"gyfnna-3"})(['font-family:"Gentium Book Basic",times,serif;font-style:italic;font-size:16px;color:#999;']),f=function(e){return r.a.createElement("div",null,r.a.createElement(c.Helmet,null,r.a.createElement("title",null,e.title)),r.a.createElement(p,null,r.a.createElement(s,null,e.title),r.a.createElement(d,null,e.date)))};r.a.Component},156:function(e,n,t){"use strict";t.d(n,"a",function(){return m});var a=t(7),o=t.n(a),i=t(0),r=t.n(i),l=(t(144),t(143)),c=(t(146),l.c.div.withConfig({displayName:"Disqus__Wrapper",componentId:"sc-1jjeqqj-0"})(["margin-top:80px;"])),m=function(e){function n(){return e.apply(this,arguments)||this}o()(n,e);var t=n.prototype;return t.render=function(){return r.a.createElement(c,null,r.a.createElement("div",{id:"disqus_thread"}))},t.componentDidMount=function(){var e,n;e=document,(n=e.createElement("script")).src="//noahgilmore-com.disqus.com/embed.js",n.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(n)},n}(r.a.Component)},169:function(e,n,t){"use strict";t(49);var a=t(7),o=t.n(a),i=t(0),r=t.n(i),l=t(146),c=t(144),m=t(154),p=t(155),s=t(34),d=t.n(s),f=t(143),g=(t(174),f.c.div.withConfig({displayName:"MarkdownContent__Container",componentId:"zl3v0s-0"})(['.format-post-preview p,.format-post-preview li{font-family:"Open Sans",arial,sans-serif;font-size:14px;line-height:14px;line-height:18px;margin-top:10px;padding-bottom:10px;}.format-post-preview p + p{margin-top:0;}.format-post-preview pre > code{font-size:12px;line-height:12px;margin-top:0;margin-bottom:0;}p,li{margin:0;padding:0;font-family:"Gentium Book Basic",times,serif;font-size:21px;line-height:26px;color:#333;padding-bottom:15px;margin-top:15px;}a{color:#1A3F4B;}code{font-family:monospace;font-size:16px;}pre{display:block;margin:0;padding:0;background:none;}pre > code{display:block;margin:0;padding:0;border:1px solid #ddd;border-radius:2px;padding:10px;margin-top:10px;font-family:monospace;font-size:14px;white-space:pre-wrap;}pre > code.hljs{border:none;}pre + p{margin-top:30px;}ol{margin-left:30px;}ol li{list-style-type:decimal;}ul li{list-style-type:square;margin-left:40px;}h1,h2,h3,h4,h5,h6{width:100%;font-family:"Roboto","Helvetica Neue","Helvetica",sans-serif;margin-bottom:10px;margin-top:40px;}h1{font-size:28px;}h2{font-size:24px;}h3{font-size:20px;}'])),u=function(e){function n(){return e.apply(this,arguments)||this}o()(n,e);var t=n.prototype;return t.render=function(){return r.a.createElement(g,null,this.props.children)},t.componentDidMount=function(){var e=d.a.findDOMNode(this).querySelectorAll("pre code");console.log("HEYYYY YAAAAAA"),console.log(e);for(var n=0;n<e.length;n++)window.hljs.highlightBlock(e[n])},n}(r.a.Component),h=t(156),x=t(159),b=t.n(x);t.d(n,"a",function(){return E});var E=function(e){function n(){return e.apply(this,arguments)||this}o()(n,e);var t=n.prototype;return t.render=function(){return r.a.createElement("div",null,r.a.createElement(c.c,null),r.a.createElement(l.Helmet,null,r.a.createElement("link",{href:"http://fonts.googleapis.com/css?family=Roboto:700",rel:"stylesheet",type:"text/css"}),r.a.createElement("link",{href:"https://fonts.googleapis.com/css?family=Gentium+Book+Basic",rel:"stylesheet"})),r.a.createElement(m.a,null),r.a.createElement(p.a,null,r.a.createElement(u,null,this.props.children),r.a.createElement(h.a,null)))},t.componentDidMount=function(){b.a.initialize("UA-35325391-1"),b.a.pageview(window.location.pathname+window.location.search)},n}(r.a.Component)}}]);
//# sourceMappingURL=component---src-pages-blog-nsobject-equatable-mdx-a815f6decd498d4ac5cc.js.map