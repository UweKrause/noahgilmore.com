---
title: Backwards compatibility for iOS 13 system colors
date: 2019-06-09
tags: ios, swift, ios 13, darkmode, uicolor
staticPreview: At WWDC 2019, Apple announced that Dark Mode would be supported on iOS 13. There are some significant changes to UIKit in order to support this - many of them are detailed in the talk Implementing Dark Mode on iOS which I'd highly recommend watching...
mdxPreview: >
    At WWDC 2019, Apple announced that Dark Mode would be supported on iOS 13. There are some significant changes to UIKit in order to support this - many of them are detailed in the talk [Implementing Dark Mode on iOS](https://developer.apple.com/videos/play/wwdc2019/214/) which I'd highly recommend watching...
---
import CaptionedImage from '../../components/CaptionedImage';

At WWDC 2019, Apple announced that Dark Mode would be supported on iOS 13. There are some significant changes to UIKit in order to support this - many of them are detailed in the talk [Implementing Dark Mode on iOS](https://developer.apple.com/videos/play/wwdc2019/214/) which I'd highly recommend watching.

One of the changes that makes adopting Dark Mode so easy is the new system colors api from `UIColor`. On iOS 12 and older, you might have a label you want to make black, and it would work just fine:

```swift
label.textColor = UIColor.black
```

But in Dark Mode, the background will also be black, which means the text won't be visible. In iOS 13+, it's better to use the new system color which will respect the user's color scheme preference:

```swift
label.textColor = UIColor.label
```

`label` is only one example: there are 36 new color scheme agnostic `UIColor`s available in iOS 13+, organized into [Element Colors](https://developer.apple.com/documentation/uikit/uicolor/ui_element_colors) (e.g. `label`) and [Standard Colors](https://developer.apple.com/documentation/uikit/uicolor/standard_colors) (`systemBlue`, `systemGray3`, etc).

## Compatibility
That's all well and good, but most of us with existing apps will still be supporting devices with iOS 12 or lower, at least for a while. This means we'll probably be doing a lot of things like this:

```swift
if #available(iOS 13, *) {
    label.textColor = .label
} else {
    label.textColor = .black
}
```

It's a workable solution, but it necessitates changing a lot of code - an `if` statement for every non-system label or background color!! For [CIFilter.io](/blog/cifilterio), I wondered if there was a better way. What if, instead of the `if #available`, there was a way to abstract the color choice down one level, so we could do something like this?

```swift
label.textColor = ColorCompatibility.label
```

## Generating system colors
I wrote a [small app](https://github.com/noahsark769/NGSystemColorComparison) (with SwiftUI, no less!) which displays all the system colors in the current color scheme.

TODO: image here

Once we have the `UIColor`s, it's easy enough to generate the implementation of `ColorCompatibility` that we want:

```swift
enum ColorCompatibility {
    static var label: UIColor {
        if #available(iOS 13, *) {
            return .label
        }
        return UIColor(red: 1.0, green: 1.0, blue: 1.0, alpha: 1.0)
    }
    static var secondaryLabel: UIColor {
        if #available(iOS 13, *) {
            return .secondaryLabel
        }
        return UIColor(red: 0.9215686274509803, green: 0.9215686274509803, blue: 0.9607843137254902, alpha: 0.6)
    }
    // ... 34 more definitions: full code at the bottom of this post
}
```

> Note: we can't use `@available` for these checks, since it doesn't provide a way to check if the current environment is _less_ than a specific app version.

Once we have `ColorCompatibility`, we can use it to set any colors we need. Note a few things:

1. This code will compile on iOS 13+, iOS 12 and earlier, and UIKitForMac ✅
2. Since everything is a computed `var`, we never store colors until we need them, which means that when the user switches color scheme, our app will automatically adapt as the trait collection changes 👍
3. When we drop iOS 12 support, cleaning this up will be as simple as replacing every instance of `ColorCompatibility` and `UILabel` 🎉

## Table of system colors

## ColorCompatibility full code