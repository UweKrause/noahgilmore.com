<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="stylesheet" href="https://meyerweb.com/eric/tools/css/reset/reset.css"/><meta name="generator" content="Gatsby 2.13.67"/><title data-react-helmet="true">Dead Simple Dependency Injection in Swift</title><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Roboto:700" rel="stylesheet" type="text/css"/><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Gentium+Book+Basic" rel="stylesheet"/><link data-react-helmet="true" rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.0/styles/atom-one-light.min.css"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@noahsark769"/><meta data-react-helmet="true" property="og:url" content="https://noahgilmore.com/blog/swift-dependency-injection/"/><meta data-react-helmet="true" property="og:title" content="Dead Simple Dependency Injection in Swift"/><meta data-react-helmet="true" property="og:description" content="At the most recent Swift Language User Group meetup, Patrick Barry presented a great talk about how Lyft implements dependency injection..."/><meta data-react-helmet="true" name="description" content="At the most recent Swift Language User Group meetup, Patrick Barry presented a great talk about how Lyft implements dependency injection..."/><style data-styled="iMCcXf  cVYlGn kTXgoV keWLqg bdgfEI hXDMKj DMJVx lkFayL kUaCUZ kdejuh gafZTn fUKgpU hMMDbz gyCUtg jLitGW ArWbr cdDtcW isFShQ ikpcIb kWZJua" data-styled-version="4.3.2">
/* sc-component-id: CaptionedImage__Wrap-ceijyq-0 */
.hMMDbz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:20px 0;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}
/* sc-component-id: CaptionedImage__Container-ceijyq-1 */
.gyCUtg{-webkit-flex:1;-ms-flex:1;flex:1;}
/* sc-component-id: CaptionedImage__Caption-ceijyq-2 */
.jLitGW{font-family:"Gentium Book Basic",times,serif;font-style:italic;font-size:16px;color:#999;margin-bottom:30px;margin-top:12px;text-align:center;} .jLitGW img{width:100%;margin-bottom:10px;}
/* sc-component-id: sc-global-1949001232 */
@font-face{font-family:'Bariol';src:url('/static/Bariol-Regular-b0d07df351f442860551405a4be58de7.eot');src:url('/static/Bariol-Regular-b0d07df351f442860551405a4be58de7.eot?#iefix') format('embedded-opentype'), url('/static/Bariol-Regular-4afd94f0fd93a1f63b46c6c6ad792f71.woff') format('woff'), url('/static/Bariol-Regular-8a7d23d53f8d118e190c63e4e81a91fe.ttf') format('truetype'), url('/static/Bariol-Regular-75b90056f4cdf5a742897ec0a59569d7.svg#svgBariolRegular') format('svg');} *{box-sizing:border-box !important;} body{margin:0;padding:0;} @media (prefers-color-scheme:dark){html,body{background-color:#2b2c2f;}}
/* sc-component-id: default__A-d4l1a1-5 */
.cdDtcW,.cdDtcW:hover,.cdDtcW:focus{outline:none;color:inherit;-webkit-text-decoration:none;text-decoration:none;}
/* sc-component-id: Nav__StyledNav-sc-1cm9dpf-0 */
.cVYlGn{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;padding:20px 60px;border-bottom:1px solid #ddd;} @media all and (max-width:600px){.cVYlGn{padding:20px;}} @media (prefers-color-scheme:dark){.cVYlGn{border-color:#777;}}
/* sc-component-id: Nav__Title-sc-1cm9dpf-1 */
.kTXgoV{-webkit-flex:2;-ms-flex:2;flex:2;font-family:"Roboto","Helvetica Neue","Helvetica",sans-serif;font-size:28px;font-display:swap;} @media (prefers-color-scheme:dark){.kTXgoV{color:#fff;}}
/* sc-component-id: Nav__NavLinks-sc-1cm9dpf-2 */
.bdgfEI{margin:0;padding:0;-webkit-flex:10;-ms-flex:10;flex:10;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:horizontal;-ms-flex-direction:horizontal;flex-direction:horizontal;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;height:100%;-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;}
/* sc-component-id: Nav__NavLink-sc-1cm9dpf-3 */
.hXDMKj{margin:0;padding:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:vertical;-ms-flex-direction:vertical;flex-direction:vertical;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;text-align:center;font-family:"Bariol","Helvetica Neue","Helvetica",sans-serif;font-size:16px;padding:0px 20px;}
/* sc-component-id: Nav__StyledA-sc-1cm9dpf-4 */
.keWLqg{height:auto;color:rgba(128,165,177,1);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:vertical;-ms-flex-direction:vertical;flex-direction:vertical;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:0.2s ease-in-out;-moz-transition:0.2s ease-in-out;-o-transition:0.2s ease-in-out;-webkit-transition:0.2s ease-in-out;transition:0.2s ease-in-out;} .keWLqg,.keWLqg:hover,.keWLqg:focus{outline:none;color:inherit;-webkit-text-decoration:none;text-decoration:none;} .keWLqg:hover{color:rgba(151,195,210,1);}
/* sc-component-id: BlogPost__BlogPostContainer-gyfnna-0 */
.DMJVx{padding:60px 0;margin:0 auto;width:90%;} @media all and (min-width:600px){.DMJVx{max-width:700px;margin:auto;}} @media all and (max-width:600px){.DMJVx{width:100%;padding:20px 0;}}
/* sc-component-id: BlogPost__TitleContainer-gyfnna-1 */
.kUaCUZ{width:100%;margin-bottom:40px;}
/* sc-component-id: BlogPost__Heading-gyfnna-2 */
.kdejuh{width:100%;font-family:"Roboto","Helvetica Neue","Helvetica",sans-serif;font-size:34px;margin-bottom:10px;line-height:1.2em;} @media (prefers-color-scheme:dark){.kdejuh{color:#fff;}}
/* sc-component-id: BlogPost__DateContainer-gyfnna-3 */
.gafZTn{font-family:"Gentium Book Basic",times,serif;font-style:italic;font-size:16px;color:#999;}
/* sc-component-id: MarkdownContent__Container-zl3v0s-0 */
.fUKgpU p,.fUKgpU li{margin:0;padding:0;font-family:"Gentium Book Basic",times,serif;font-size:21px;line-height:29px;color:#333;padding-bottom:15px;margin-top:15px;} @media all and (max-width:600px){.fUKgpU p,.fUKgpU li{width:90%;margin:15px auto 0 auto;}} @media (prefers-color-scheme:dark){.fUKgpU p,.fUKgpU li{color:#fff;}} .fUKgpU blockquote{background-color:#faf9f7;border-left:4px solid #e5e4e1;padding:20px;font-style:italic;} @media (prefers-color-scheme:dark){.fUKgpU blockquote{background-color:#3f3f3f;}} .fUKgpU blockquote p{margin:0;padding:0;color:#555;} @media (prefers-color-scheme:dark){.fUKgpU blockquote p{color:#fff;}} .fUKgpU a{color:#1A3F4B;-webkit-transition:0.2s ease-in-out;-moz-transition:0.2s ease-in-out;-o-transition:0.2s ease-in-out;-webkit-transition:0.2s ease-in-out;transition:0.2s ease-in-out;} @media (prefers-color-scheme:dark){.fUKgpU a{color:#60b5d1;}} .fUKgpU a:hover{color:#47656E;} @media (prefers-color-scheme:dark){.fUKgpU a:hover{color:#6bcfef;}} .fUKgpU code{font-family:monospace;font-size:16px;padding:3px 5px;margin:0px 2px;} @media (prefers-color-scheme:dark){.fUKgpU code{color:#fff;}} .fUKgpU code:not(.vscode-highlight-code){font-family:monospace;font-size:16px;background-color:#faf9f7;border:1px solid #e5e4e1;padding:3px 5px;margin:0px 2px;color:#555;} @media (prefers-color-scheme:dark){.fUKgpU code:not(.vscode-highlight-code){color:#fff;background-color:#3f3f3f;}} .fUKgpU code:first-child{margin-left:0;} .fUKgpU pre{display:block;margin:0;padding:0;margin-top:10px;border:1px solid #e5e4e1;border-radius:2px;} @media all and (max-width:600px){.fUKgpU pre{width:100%;margin:10px auto 0 auto;border-left:none;border-right:none;border-radius:0;overflow-x:scroll;}} .fUKgpU pre > code{display:block;margin:0;padding:10px;font-family:monospace;font-size:14px;line-height:17px;white-space:pre-wrap;} @media all and (max-width:600px){.fUKgpU pre > code{font-size:15px;white-space:pre;padding:15px 5% 15px 5%;width:100%;}} .fUKgpU pre + p{margin-top:30px;} .fUKgpU ol{margin-left:30px;} @media all and (max-width:600px){.fUKgpU ol{width:90%;margin:0 auto 0 30px;}} @media (prefers-color-scheme:dark){.fUKgpU ol{color:#fff;}} .fUKgpU ol li{list-style-type:decimal;} .fUKgpU ul li{list-style-type:square;margin-left:40px;} @media all and (max-width:600px){.fUKgpU ul li{width:90%;margin:0 auto;}} @media (prefers-color-scheme:dark){.fUKgpU ul li{color:#fff;}} .fUKgpU h1,.fUKgpU h2,.fUKgpU h3,.fUKgpU h4,.fUKgpU h5,.fUKgpU h6{width:100%;font-family:"Roboto","Helvetica Neue","Helvetica",sans-serif;margin-bottom:10px;margin-top:40px;} @media all and (max-width:600px){.fUKgpU h1,.fUKgpU h2,.fUKgpU h3,.fUKgpU h4,.fUKgpU h5,.fUKgpU h6{width:90%;margin:40px auto 10px auto;}} @media (prefers-color-scheme:dark){.fUKgpU h1,.fUKgpU h2,.fUKgpU h3,.fUKgpU h4,.fUKgpU h5,.fUKgpU h6{color:#fff;}} .fUKgpU h1{font-size:28px;} .fUKgpU h2{font-size:24px;} .fUKgpU h3{font-size:20px;} .fUKgpU em{font-style:italic;} .fUKgpU strong{font-weight:bold;}
/* sc-component-id: EndButtons__Container-sc-2ta1su-0 */
.ArWbr{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:horizontal;-ms-flex-direction:horizontal;flex-direction:horizontal;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-top:40px;}
/* sc-component-id: EndButtons__ButtonStyle-sc-2ta1su-1 */
.isFShQ{background-color:rgba(128,165,177,1);-webkit-transition:0.2s ease-in-out;-moz-transition:0.2s ease-in-out;-o-transition:0.2s ease-in-out;-webkit-transition:0.2s ease-in-out;transition:0.2s ease-in-out;width:100px;padding:10px 20px;text-align:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:vertical;-ms-flex-direction:vertical;flex-direction:vertical;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:4px;margin-right:20px;} .isFShQ:hover{background-color:rgba(151,195,210,1);}.ikpcIb{background-color:rgba(128,165,177,1);-webkit-transition:0.2s ease-in-out;-moz-transition:0.2s ease-in-out;-o-transition:0.2s ease-in-out;-webkit-transition:0.2s ease-in-out;transition:0.2s ease-in-out;width:100px;padding:10px 20px;text-align:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:vertical;-ms-flex-direction:vertical;flex-direction:vertical;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:4px;} .ikpcIb:hover{background-color:rgba(151,195,210,1);}
/* sc-component-id: Disqus__Wrapper-sc-1jjeqqj-0 */
.kWZJua{margin-top:80px;}
/* sc-component-id: BlogPageLayout__Container-sc-118ribu-0 */
@media (prefers-color-scheme:dark){.iMCcXf{background-color:#2b2c2f;}}
/* sc-component-id: BlogPageLayout__NonContent-sc-118ribu-1 */
@media all and (max-width:600px){.lkFayL{padding-right:5%;padding-left:5%;}}</style><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="alternate" type="application/rss+xml" title="Noah Gilmore&#x27;s Development Blog: iOS" href="/blog/ios.xml"/><link rel="alternate" type="application/rss+xml" title="Noah Gilmore&#x27;s Development Blog: Web" href="/blog/web.xml"/><link rel="alternate" type="application/rss+xml" title="Noah Gilmore&#x27;s Development Blog" href="/blog/rss.xml"/><link as="script" rel="preload" href="/webpack-runtime-3cac40ee9ed869cd191e.js"/><link as="script" rel="preload" href="/app-660cc945d02a72283990.js"/><link as="script" rel="preload" href="/0-e6536100725f44371b25.js"/><link as="script" rel="preload" href="/1-d464cbfb3b28ac4f2518.js"/><link as="script" rel="preload" href="/2-edfbcd66d0e242a87090.js"/><link as="script" rel="preload" href="/component---src-pages-blog-swift-dependency-injection-mdx-cf3d8cd610d711020c5a.js"/><link as="fetch" rel="preload" href="/page-data/blog/swift-dependency-injection/page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="BlogPageLayout__Container-sc-118ribu-0 iMCcXf"><nav class="Nav__StyledNav-sc-1cm9dpf-0 cVYlGn"><div class="Nav__Title-sc-1cm9dpf-1 kTXgoV"><a href="/blog" class="default__A-d4l1a1-5 Nav__StyledA-sc-1cm9dpf-4 keWLqg">NOAH GILMORE</a></div><ul class="default__UL-d4l1a1-2 Nav__NavLinks-sc-1cm9dpf-2 bdgfEI"><li class="default__LI-d4l1a1-3 Nav__NavLink-sc-1cm9dpf-3 hXDMKj"><a aria-label="Blog Home" href="/blog" class="default__A-d4l1a1-5 Nav__StyledA-sc-1cm9dpf-4 keWLqg"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" color="rgba(128, 165, 177, 1)" size="24" style="color:rgba(128, 165, 177, 1)" height="24" width="24"><path d="M258.5 104.1c-1.5-1.2-3.5-1.2-5 0l-156 124.8c-.9.8-1.5 1.9-1.5 3.1v230c0 1.1.9 2 2 2h108c1.1 0 2-.9 2-2V322c0-1.1.9-2 2-2h92c1.1 0 2 .9 2 2v140c0 1.1.9 2 2 2h108c1.1 0 2-.9 2-2V232c0-1.2-.6-2.4-1.5-3.1l-156-124.8z"></path><path d="M458.7 204.2l-189-151.4C265.9 49.7 261 48 256 48s-9.9 1.7-13.7 4.8L160 119.7V77.5c0-1.1-.9-2-2-2H98c-1.1 0-2 .9-2 2v92.2l-42.7 35.1c-3.1 2.5-5.1 6.2-5.3 10.2-.2 4 1.3 7.9 4.1 10.7 2.6 2.6 6.1 4.1 9.9 4.1 3.2 0 6.3-1.1 8.8-3.1l183.9-148c.5-.4.9-.4 1.3-.4s.8.1 1.3.4l183.9 147.4c2.5 2 5.6 3.1 8.8 3.1 3.7 0 7.2-1.4 9.9-4.1 2.9-2.8 4.4-6.7 4.2-10.7-.3-4-2.2-7.7-5.4-10.2z"></path></svg></a></li><li class="default__LI-d4l1a1-3 Nav__NavLink-sc-1cm9dpf-3 hXDMKj"><a aria-label="Twitter" href="https://twitter.com/noahsark769" class="default__A-d4l1a1-5 Nav__StyledA-sc-1cm9dpf-4 keWLqg"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" color="rgba(128, 165, 177, 1)" size="24" style="color:rgba(128, 165, 177, 1)" height="24" width="24"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a></li><li class="default__LI-d4l1a1-3 Nav__NavLink-sc-1cm9dpf-3 hXDMKj"><a aria-label="App Store" href="https://itunes.apple.com/us/app/trestle-the-new-sudoku/id1300230302?mt=8" class="default__A-d4l1a1-5 Nav__StyledA-sc-1cm9dpf-4 keWLqg"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" color="rgba(128, 165, 177, 1)" size="24" style="color:rgba(128, 165, 177, 1)" height="24" width="24"><path d="M256 48C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48zm-78.9 296.9c-2.7 4.6-7.5 7.1-12.5 7.1-2.5 0-5-.6-7.3-2-6.9-4-9.2-12.8-5.2-19.7l14.2-23.6c1.5-2.5 4.1-4 7-4h2.1c10.3 0 17.5 6.2 19.6 12.2l-17.9 30zm120.2-46.4l-93 .1h-61.8c-8.2 0-14.8-6.8-14.4-15 .3-7.8 7.1-13.7 14.9-13.7h44.8l53.1-90.4-17.2-29.3c-3.9-6.7-2.2-15.5 4.4-19.7 7-4.5 16.2-2.2 20.3 4.8l9.2 15.7h.1l9.2-15.7c4.1-7 13.4-9.3 20.3-4.8 6.6 4.2 8.3 13 4.4 19.7l-17.2 29.3-16.7 28.5-36.3 61.9v.1h53.5c6.7 0 15.1 3.6 18.5 9.4l.3.6c3 5.1 4.7 8.6 4.7 13.7-.1 2.8-1.1 4.8-1.1 4.8zm72.2.1h-25.2v.1l18.4 31.3c4 6.8 2.1 15.8-4.8 20-2.3 1.4-4.9 2.1-7.5 2.1-5 0-9.8-2.6-12.5-7.1l-27.2-46.3-16.9-28.8-21.8-37.3c-6.4-10.9-6.7-24.5-.6-35.3 4.3-7.6 7.6-9.6 7.6-9.6l48.5 82.1h41.7c7.8 0 14.5 6 14.9 13.7.3 8.3-6.3 15.1-14.6 15.1z"></path></svg></a></li></ul></nav><div class="BlogPost__BlogPostContainer-gyfnna-0 DMJVx"><div class="BlogPageLayout__NonContent-sc-118ribu-1 lkFayL"><div><div class="BlogPost__TitleContainer-gyfnna-1 kUaCUZ"><h1 class="BlogPost__Heading-gyfnna-2 kdejuh">Dead Simple Dependency Injection in Swift</h1><p class="BlogPost__DateContainer-gyfnna-3 gafZTn">February 14, 2019</p></div></div></div><div class="MarkdownContent__Container-zl3v0s-0 fUKgpU"><p>At the most recent <a href="https://www.meetup.com/swift-language/">Swift Language User Group</a> meetup, <a href="https://twitter.com/patbarry">Patrick Barry</a> presented a <a href="https://www.youtube.com/watch?v=dA9rGQRwHGs">great talk</a> about how Lyft implements dependency injection. I&#x27;d highly recommend watching the video - I was impressed by how clean and functional the solution they came up with is. I was going to write up a summary for my coworkers, but figured I might as well put it here for the benefit of anyone who&#x27;s interested.</p><p>This post describes the very simple approach to dependency injection presented in the talk, using new functions <code>bind</code> and <code>mock</code>. I&#x27;ll paraphrase some code in this write up, but the concepts and function names will match the talk.</p><p><em>Edit (4/30/2019): This post describes a nice Swift implementation of a pattern similar to the <a href="https://en.wikipedia.org/wiki/Service_locator_pattern">Service Locator Pattern</a>, considered by many to be a strong anti-pattern. Like Singletons, you should use Service Locator carefully - I&#x27;ve added a <a href="#downsides">section</a> at the end about drawbacks of this approach.</em></p><h2>Dependency Injection</h2><p>I won&#x27;t go into detail on what dependency injection is, since there&#x27;s a fair amount of time in the talk dedicated to it. Instead, let&#x27;s think about an example.</p><p>Say we&#x27;re writing an app to display info about cats. We would have a <code>Cat</code> model in our app:</p><pre class="dark-default-dark vscode-highlight" data-language="swift"><code class="vscode-highlight-code"><span class="vscode-highlight-line"><span class="mtk4">struct</span><span class="mtk1"> </span><span class="mtk10">Cat</span><span class="mtk1">: Codable {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> name: </span><span class="mtk10">String</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> image: URL</span></span>
<span class="vscode-highlight-line"><span class="mtk1">}</span></span></code></pre><p>And let&#x27;s assume we have an API to fetch a cat by name:</p><pre class="dark-default-dark vscode-highlight" data-language=""><code class="vscode-highlight-code"><span class="vscode-highlight-line">GET /cat?id=2</span>
<span class="vscode-highlight-line">{</span>
<span class="vscode-highlight-line">    &quot;name&quot;: &quot;Maggie&quot;,</span>
<span class="vscode-highlight-line">    &quot;image&quot;: &quot;https://placekitten.com/200/200&quot;</span>
<span class="vscode-highlight-line">}</span></code></pre><p>From an architectural point of view, we want to extract this into two different parts:</p><ol><li>A <code>NetworkService</code> which makes the requests</li><li>A <code>CatService</code> which exposes a <code>getCat(id:)</code> method (this calls into the network service)</li></ol><div class="CaptionedImage__Wrap-ceijyq-0 hMMDbz"><div class="CaptionedImage__Container-ceijyq-1 gyCUtg"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden"><div style="width:100%;padding-bottom:19.278996865203762%"></div><img alt="Diagram of CatService calling NetworkService" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAzUlEQVQY002O20rDQBRF8/8fpemT1RcfFNQWtDRFCpo0c79nOdMW9cBin8NeDNOFEIgxUspCdIZoZqIVF9ruFDlnjDHnzCn99f8xgpITndYaay3aWOTwhNutUR9r9O4eW3czPKKVREqJ8x4xHlHvd+jmXDHVbRnUSCeEwFfRh4j9fEZtesaXG+a3HrVd1YcfkGIm1Z+FmHDym6n20+stp0pzxWZV6Qnyi66UwrIstPFV9uOecDrgG9MePx8v/dXJKeCmw69zznq7aSAFxw9c/i7ojOc7iwAAAABJRU5ErkJggg==" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition:opacity 0.5s;transition-delay:0.25s"/><noscript><picture><source srcSet="/static/9283ef3c7d8f2946cca0bb9f4dc6080c/d3809/swift-di-1.png 150w,
/static/9283ef3c7d8f2946cca0bb9f4dc6080c/fdbb0/swift-di-1.png 300w,
/static/9283ef3c7d8f2946cca0bb9f4dc6080c/59139/swift-di-1.png 600w,
/static/9283ef3c7d8f2946cca0bb9f4dc6080c/cb30f/swift-di-1.png 900w,
/static/9283ef3c7d8f2946cca0bb9f4dc6080c/ba299/swift-di-1.png 1200w,
/static/9283ef3c7d8f2946cca0bb9f4dc6080c/671ff/swift-di-1.png 1276w" sizes="(max-width: 600px) 100vw, 600px" /><img src="/static/9283ef3c7d8f2946cca0bb9f4dc6080c/59139/swift-di-1.png" alt="Diagram of CatService calling NetworkService" style="position:absolute;top:0;left:0;transition:opacity 0.5s;transition-delay:0.5s;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><div class="CaptionedImage__Caption-ceijyq-2 jLitGW"></div></div></div><h2>Binding</h2><p>There&#x27;s a clear <a href="#seam">seam</a> between the <code>NetworkService</code> and <code>CatService</code> that we can use to test <code>CatService</code>. Let&#x27;s extract the network&#x27;s functionality into an interface:</p><pre class="dark-default-dark vscode-highlight" data-language="swift"><code class="vscode-highlight-code"><span class="vscode-highlight-line"><span class="mtk4">protocol</span><span class="mtk1"> </span><span class="mtk10">NetworkInterface</span><span class="mtk1"> {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk4">func</span><span class="mtk1"> </span><span class="mtk11">makeRequest</span><span class="mtk1">(</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk11">url</span><span class="mtk1">: URL,</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk11">completion</span><span class="mtk1">: </span><span class="mtk4">@escaping</span><span class="mtk1"> (Result&lt;Data, </span><span class="mtk10">Error</span><span class="mtk1">&gt;) -&gt; </span><span class="mtk10">Void</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    )</span></span>
<span class="vscode-highlight-line"><span class="mtk1">}</span></span></code></pre><p>And the concrete implementation:</p><pre class="dark-default-dark vscode-highlight" data-language=""><code class="vscode-highlight-code"><span class="vscode-highlight-line">private class NetworkService: NetworkInterface {</span>
<span class="vscode-highlight-line">    func makeRequest(</span>
<span class="vscode-highlight-line">        url: URL,</span>
<span class="vscode-highlight-line">        completion: @escaping (Result&lt;Data, Error&gt;) -&gt; Void</span>
<span class="vscode-highlight-line">    ) {</span>
<span class="vscode-highlight-line">        // Use URLSession, etc</span>
<span class="vscode-highlight-line">    }</span>
<span class="vscode-highlight-line">}</span></code></pre><p>And now for the really interesting part - <code>NetworkService</code> will <em>expose itself using a special function called bind</em> (I&#x27;ve added the &quot;SimpleDI&quot; namespace here):</p><pre class="dark-default-dark vscode-highlight" data-language="swift"><code class="vscode-highlight-code"><span class="vscode-highlight-line"><span class="mtk4">let</span><span class="mtk1"> getNetwork = SimpleDI.</span><span class="mtk11">bind</span><span class="mtk1">(NetworkInterface.self) { </span><span class="mtk11">NetworkService</span><span class="mtk1">() }</span></span></code></pre><p><code>bind</code> returns <code>getNetwork</code> as a function which can be called to get a concrete implementation of the <code>NetworkInterface</code> protocol. <code>CatService</code> can then call <code>getNetwork</code> to get access to the network:</p><pre class="dark-default-dark vscode-highlight" data-language=""><code class="vscode-highlight-code"><span class="vscode-highlight-line">class CatService {</span>
<span class="vscode-highlight-line">    func getCat(id: Int, completion: @escaping (Result&lt;Cat, Error&gt;) -&gt; Void) {</span>
<span class="vscode-highlight-line">        let network = getNetwork()</span>
<span class="vscode-highlight-line">        network.makeRequest(/* ... */)</span>
<span class="vscode-highlight-line">    }</span>
<span class="vscode-highlight-line">}</span></code></pre><div class="CaptionedImage__Wrap-ceijyq-0 hMMDbz"><div class="CaptionedImage__Container-ceijyq-1 gyCUtg"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden"><div style="width:100%;padding-bottom:23.36448598130841%"></div><img alt="Diagram of CatService calling NetworkService, with bind as an intermediary" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA7klEQVQY01WP2U7DMBRE8/+fhMT2wA8UKKVKUyISCKq34jiLm+TgOEWUkY7m+mpGuk6maeIXLmHxuD+rqirSNEVrzTAMeO8jY5ijQjbhQnN1nP6Y+C9rLUII+r6P72EEfxppO790A4lzLgQ8jdW0hx293C+IHd3xi6ZpUUohpYwuDgeatqXRFV5mdCKjrrZh3tPJN5K6tnT9CSdLXHqPernm+HqH3d5SFyuUNpRFQZ7nFMHnWSqDLdfo9RUmZPXmBhNw2QPJfP4Y/u6bb9zHM3V5pnikVQUuXigxxkTmS+ddbyrs+ypmbew84T43/ABPA33TkXkUsgAAAABJRU5ErkJggg==" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition:opacity 0.5s;transition-delay:0.25s"/><noscript><picture><source srcSet="/static/b07c5c2d7f1fbb345ac67d7ead6d9651/d3809/swift-di-2.png 150w,
/static/b07c5c2d7f1fbb345ac67d7ead6d9651/fdbb0/swift-di-2.png 300w,
/static/b07c5c2d7f1fbb345ac67d7ead6d9651/59139/swift-di-2.png 600w,
/static/b07c5c2d7f1fbb345ac67d7ead6d9651/cb30f/swift-di-2.png 900w,
/static/b07c5c2d7f1fbb345ac67d7ead6d9651/ba299/swift-di-2.png 1200w,
/static/b07c5c2d7f1fbb345ac67d7ead6d9651/c959d/swift-di-2.png 1498w" sizes="(max-width: 600px) 100vw, 600px" /><img src="/static/b07c5c2d7f1fbb345ac67d7ead6d9651/59139/swift-di-2.png" alt="Diagram of CatService calling NetworkService, with bind as an intermediary" style="position:absolute;top:0;left:0;transition:opacity 0.5s;transition-delay:0.5s;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><div class="CaptionedImage__Caption-ceijyq-2 jLitGW"></div></div></div><h2>Implementation</h2><p>Before we talk about why <code>bind</code> is useful, let&#x27;s discuss the implementation. <code>bind</code> returns a function which takes no parameters and returns a type of <code>NetworkInterface</code>, but it also takes a closure which will be used to generate the concrete implementation.</p><p><code>bind</code>&#x27;s body looks like this (again, paraphrased a bit from the talk):</p><pre class="dark-default-dark vscode-highlight" data-language="swift"><code class="vscode-highlight-code"><span class="vscode-highlight-line"><span class="mtk4">private</span><span class="mtk1"> </span><span class="mtk4">var</span><span class="mtk1"> instantiators: [</span><span class="mtk10">String</span><span class="mtk1">: </span><span class="mtk10">Any</span><span class="mtk1">] = [:]</span></span>
<span class="vscode-highlight-line"><span class="mtk1"></span></span>
<span class="vscode-highlight-line"><span class="mtk4">enum</span><span class="mtk1"> </span><span class="mtk10">SimpleDI</span><span class="mtk1"> {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk4">static</span><span class="mtk1"> </span><span class="mtk4">func</span><span class="mtk1"> </span><span class="mtk11">bind</span><span class="mtk1">&lt;</span><span class="mtk4">T</span><span class="mtk1">&gt;(</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk11">_</span><span class="mtk1"> </span><span class="mtk12">interfaceType</span><span class="mtk1">: T.Type,</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk11">instantiator</span><span class="mtk1">: </span><span class="mtk4">@escaping</span><span class="mtk1"> () -&gt; T</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    ) -&gt; () -&gt; T {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        instantiators[</span><span class="mtk10">String</span><span class="mtk1">(</span><span class="mtk11">describing</span><span class="mtk1">: interfaceType)] = instantiator</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk4">self</span><span class="mtk1">.</span><span class="mtk12">instance</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    }</span></span>
<span class="vscode-highlight-line"><span class="mtk1"></span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk4">private</span><span class="mtk1"> </span><span class="mtk4">static</span><span class="mtk1"> </span><span class="mtk4">func</span><span class="mtk1"> </span><span class="mtk11">instance</span><span class="mtk1">&lt;</span><span class="mtk4">T</span><span class="mtk1">&gt;() -&gt; T {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk4">let</span><span class="mtk1"> key = </span><span class="mtk10">String</span><span class="mtk1">(</span><span class="mtk11">describing</span><span class="mtk1">: T.self)</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk4">let</span><span class="mtk1"> instantiator = instantiators[key] as! () -&gt; T</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk11">instantiator</span><span class="mtk1">()</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    }</span></span>
<span class="vscode-highlight-line"><span class="mtk1">}</span></span></code></pre><p>We take the closure that we&#x27;re passed and save it in a dictionary (<a href="#dictionary-atomic">see end note</a>), then return a function which accesses and calls the closure we provided. Though we have to do some force casting, we&#x27;re guaranteed that the closure we need will be there when <code>getNetworkInterface</code> is called, since we put it into <code>instantiators</code> before returning from <code>bind</code>.</p><h2>Testability</h2><p>Using <code>bind</code> adds a level of indirection at the seam between <code>NetworkService</code> and <code>CatService</code>, which allows us to stub in a mock in tests. In order to do that, we need to define <code>mock</code> as well, and add a bit of more infrastructure:</p><pre class="dark-default-dark vscode-highlight" data-language="swift"><code class="vscode-highlight-code"><span class="vscode-highlight-line"><span class="mtk4">private</span><span class="mtk1"> </span><span class="mtk4">var</span><span class="mtk1"> instantiators: [</span><span class="mtk10">String</span><span class="mtk1">: </span><span class="mtk10">Any</span><span class="mtk1">] = [:]</span></span>
<span class="vscode-highlight-line"><span class="mtk4">private</span><span class="mtk1"> </span><span class="mtk4">var</span><span class="mtk1"> mockInstantiators: [</span><span class="mtk10">String</span><span class="mtk1">: </span><span class="mtk10">Any</span><span class="mtk1">] = [:]</span></span>
<span class="vscode-highlight-line"><span class="mtk1"></span></span>
<span class="vscode-highlight-line"><span class="mtk4">enum</span><span class="mtk1"> </span><span class="mtk10">SimpleDI</span><span class="mtk1"> {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk4">static</span><span class="mtk1"> </span><span class="mtk4">var</span><span class="mtk1"> isTestEnvironment = </span><span class="mtk4">false</span></span>
<span class="vscode-highlight-line"><span class="mtk1"></span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk4">static</span><span class="mtk1"> </span><span class="mtk4">func</span><span class="mtk1"> </span><span class="mtk11">bind</span><span class="mtk1">&lt;</span><span class="mtk4">T</span><span class="mtk1">&gt;(</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk11">_</span><span class="mtk1"> </span><span class="mtk12">type</span><span class="mtk1">: T.Type,</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk11">instantiator</span><span class="mtk1">: </span><span class="mtk4">@escaping</span><span class="mtk1"> () -&gt; T</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    ) -&gt; () -&gt; T {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        instantiators[</span><span class="mtk10">String</span><span class="mtk1">(</span><span class="mtk11">describing</span><span class="mtk1">: type)] = instantiator</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk4">self</span><span class="mtk1">.</span><span class="mtk12">instance</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    }</span></span>
<span class="vscode-highlight-line"><span class="mtk1"></span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk4">private</span><span class="mtk1"> </span><span class="mtk4">static</span><span class="mtk1"> </span><span class="mtk4">func</span><span class="mtk1"> </span><span class="mtk11">instance</span><span class="mtk1">&lt;</span><span class="mtk4">T</span><span class="mtk1">&gt;() -&gt; T {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk4">let</span><span class="mtk1"> key = </span><span class="mtk10">String</span><span class="mtk1">(</span><span class="mtk11">describing</span><span class="mtk1">: T.self)</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk15">if</span><span class="mtk1"> </span><span class="mtk4">self</span><span class="mtk1">.</span><span class="mtk12">isTestEnvironment</span><span class="mtk1"> {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            </span><span class="mtk15">guard</span><span class="mtk1"> </span><span class="mtk4">let</span><span class="mtk1"> instantiator = mockInstantiators[key] as? () -&gt; T </span><span class="mtk15">else</span><span class="mtk1"> {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                </span><span class="mtk11">fatalError</span><span class="mtk1">(</span><span class="mtk8">&quot;Type </span><span class="mtk6">\\</span><span class="mtk8">(key) unmocked in test!&quot;</span><span class="mtk1">)</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            }</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk11">instantiator</span><span class="mtk1">()</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        }</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk4">let</span><span class="mtk1"> instantiator = instantiators[key] as! () -&gt; T</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk11">instantiator</span><span class="mtk1">()</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    }</span></span>
<span class="vscode-highlight-line"><span class="mtk1"></span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk4">static</span><span class="mtk1"> </span><span class="mtk4">func</span><span class="mtk1"> </span><span class="mtk11">mock</span><span class="mtk1">&lt;</span><span class="mtk4">T</span><span class="mtk1">&gt;(</span><span class="mtk11">_</span><span class="mtk1"> </span><span class="mtk12">type</span><span class="mtk1">: T.Type, </span><span class="mtk11">instantiator</span><span class="mtk1">: </span><span class="mtk4">@escaping</span><span class="mtk1"> () -&gt; T) {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        mockInstantiators[</span><span class="mtk10">String</span><span class="mtk1">(</span><span class="mtk11">describing</span><span class="mtk1">: type)] = instantiator</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    }</span></span>
<span class="vscode-highlight-line"><span class="mtk1">}</span></span></code></pre><p>This code isn&#x27;t very pretty - in fact, checks like <code>isTestEnvironment</code> are generally a code smell that mean you should refactor how the class works to avoid the check. However, this enables us to write tests very easily: all we have to do is set <code>isTestEnvironment = true</code>, and we&#x27;ll be able to <a href="#mock">stub in a mock</a> immediately using <code>mock</code>.</p><h2>Example</h2><p>Let&#x27;s say we want to write a test which makes sure CatService reports an error when the underlying network errors:</p><pre class="dark-default-dark vscode-highlight" data-language=""><code class="vscode-highlight-code"><span class="vscode-highlight-line">class NetworkThatAlwaysErrors: NetworkInterface {</span>
<span class="vscode-highlight-line">    func makeRequest(url: URL, completion: @escaping (Result&lt;Data&gt;) -&gt; Void) {</span>
<span class="vscode-highlight-line">        completion(.error(error: NSError(domain: &quot;&quot;, code: 0, userInfo: nil)))</span>
<span class="vscode-highlight-line">    }</span>
<span class="vscode-highlight-line">}</span>
<span class="vscode-highlight-line"></span>
<span class="vscode-highlight-line">class CatServiceTestCase: XCTestCase {</span>
<span class="vscode-highlight-line">    func testCatServiceReportsError() {</span>
<span class="vscode-highlight-line">        SimpleDI.isTestEnvironment = true</span>
<span class="vscode-highlight-line">        SimpleDI.mock(NetworkInterface.self) { NetworkThatAlwaysErrors() }</span>
<span class="vscode-highlight-line"></span>
<span class="vscode-highlight-line">        let expecation = self.expectation(description: &quot;Should return error&quot;)</span>
<span class="vscode-highlight-line">        let service = CatService()</span>
<span class="vscode-highlight-line">        service.getCatImage(named: &quot;Maggie&quot;, completion: { result in</span>
<span class="vscode-highlight-line">            if case .error = result {</span>
<span class="vscode-highlight-line">                expecation.fulfill()</span>
<span class="vscode-highlight-line">            }</span>
<span class="vscode-highlight-line">        })</span>
<span class="vscode-highlight-line">        self.waitForExpectations(timeout: 0.2)</span>
<span class="vscode-highlight-line">    }</span>
<span class="vscode-highlight-line">}</span></code></pre><p><code>bind</code> and <code>mock</code> take the dirty work of setting up the DI/mocking infrastructure and hide it under the rug, allowing us to write more expressive tests easily.</p><div class="CaptionedImage__Wrap-ceijyq-0 hMMDbz"><div class="CaptionedImage__Container-ceijyq-1 gyCUtg"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden"><div style="width:100%;padding-bottom:47.320410490307864%"></div><img alt="Diagram of bind and mock being used to separate CatService and NetworkService and stub in a mock in tests" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAByklEQVQoz22RwXaiQBBF/f/PMtEQEBQjQRBCSAwINDY0apLZ3Ck0J4s5s7jnVcGrR3UziUuDnyk275qwPP+HC9tiIH/fk+0rNvuBYG8IPsyvZys8Fyde1SeTzceAnWrc1x7vSvejPW5ufp53+GnJMq2lN9feSRTuyxEvv/mczFyDJ+tcM99WYmioUh+T2fSZg8481mnBe9lwqIWqIXxTxPGWQTw6dcRn02ZLxgw3H4gPEui+tNxHDVbSUiQr1G5OHT9QJw6r5AOlWjqtMd2RrGgJoy0qnnGIHmjEV+4WeNkRKxt4HjfUpz8o832l0Z80x8uNsdZnyrKkKEoOoodaofovVHcWLj96qxuhO30z+ZIvGs/l7Ptcdiu+s/WN8fjBE1VV0dQ1tZKwPKdb+uggRm+2V7pNRBdE6KeQU/IiG7oe6u6edjani+7lbqboZIpJ7qgci7pRtHLktu+p05S3qcVu7pPMViTz1VV3Yz3zqZ+iW+AY1j/asqnNsBIVhqWoIz/HX8smG5r1mnbh0tsLWttDOx615dBYC45SK6mHIGQyyMAYdhbzyf4HR67CFqOz4C14ppRgYz2K/xEjM51lMcj7i8yepf8MQ/4CepiLb8r2P6QAAAAASUVORK5CYII=" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition:opacity 0.5s;transition-delay:0.25s"/><noscript><picture><source srcSet="/static/abc8172c2555a48adb1a0e19b7691ec3/d3809/swift-di-3.png 150w,
/static/abc8172c2555a48adb1a0e19b7691ec3/fdbb0/swift-di-3.png 300w,
/static/abc8172c2555a48adb1a0e19b7691ec3/59139/swift-di-3.png 600w,
/static/abc8172c2555a48adb1a0e19b7691ec3/cb30f/swift-di-3.png 900w,
/static/abc8172c2555a48adb1a0e19b7691ec3/ba299/swift-di-3.png 1200w,
/static/abc8172c2555a48adb1a0e19b7691ec3/22766/swift-di-3.png 1754w" sizes="(max-width: 600px) 100vw, 600px" /><img src="/static/abc8172c2555a48adb1a0e19b7691ec3/59139/swift-di-3.png" alt="Diagram of bind and mock being used to separate CatService and NetworkService and stub in a mock in tests" style="position:absolute;top:0;left:0;transition:opacity 0.5s;transition-delay:0.5s;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><div class="CaptionedImage__Caption-ceijyq-2 jLitGW"></div></div></div><p>Some interesting things to note:</p><ol><li>Many people who&#x27;ve worked with DI have horror stories of passing 10/15+ dependencies into an initializer so they can be mocked in tests. <code>bind</code> brings the argument count down to 0 without sacrificing testability, and makes both the service and the test more elegant.</li><li><code>bind</code> will error if you forget to mock out an interface in a test, so you&#x27;re never accidentally calling deeper into dependencies than you mean to.</li></ol><a name="downsides"></a><h2>Downsides</h2><p>This approach is very similar to the <a href="https://en.wikipedia.org/wiki/Service_locator_pattern">Service Locator Pattern</a>, which is commonly criticized. I really enjoyed <a href="https://badootech.badoo.com/singleton-service-locator-and-tests-in-ios-d69484e88944">this article</a> about Service Locator in iOS, and there are a few downsides that I should mention:</p><ol><li>Using a service locator registry like <code>bind</code> means you have implicit instead of explicit dependencies. Instead of knowing explicitly that <code>CatService</code> depends on <code>NetworkService</code>, you have to look for the call to <code>getNetwork</code>. There&#x27;s a tradeoff between the simplicity of using a service locator and the fact that it can make services with many dependencies more complex to reason about.</li><li>With <code>bind</code>, it can be tough to recognize that you can update a test when a dependency of a service is removed. If <code>CatService</code> stopped calling out to the network, it&#x27;s wouldn&#x27;t be immediately apparent that <code>NetworkThatAlwaysErrors</code> could be deleted. This can lead to unnessary cognitive overhead in tests.</li><li>When calling <code>mock</code>, you have to be <em>very</em> careful to set up your testing framework such that all the mocks get cleared after every test. Otherwise, you might have different behavior based on the order the tests are run, which can lead to flakes.</li></ol><h2>Conclusion</h2><p>It was really interesting to see how Lyft was able to come up with such a simple solution to a complex problem. I&#x27;d really recommend watching <a href="https://www.youtube.com/watch?v=dA9rGQRwHGs">the talk</a> if you&#x27;re interested in dependency injection and testing. If you&#x27;d like to see a working example of <code>bind</code> and <code>mock</code>, I&#x27;ve put one <a href="https://github.com/noahsark769/NGSimpleDIExample">here</a> (it has a few differences from the code in this post in order to demonstrate an actual working request and test).</p><h2>Footnotes</h2><ol><li><a name="dictionary-atomic"></a>Dictionary is not thread safe, so if you want to use `bind` and `mock` on multiple threads you&#x27;ll need to implement something similar to an [atomic box](https://www.objc.io/blog/2018/12/18/atomic-variables/) (the talk mentions this).</li><li><a name="seam"></a>&quot;[Seam](http://wiki.c2.com/?SoftwareSeam)&quot; is a concept that seems to have been first coined in [Working Effectively With Legacy Code](https://www.amazon.com/Working-Effectively-Legacy-Michael-Feathers/dp/0131177052). It&#x27;s defined as &quot;[a place where two parts of the software meet and where something else can be injected](https://softwareengineering.stackexchange.com/questions/132563/problem-with-understanding-seam-word/311122)&quot;.</li><li><a name="mock"></a>You could even put `mock` in your test target to make sure it can&#x27;t be called in production!</li></ol><style class="vscode-highlight-styles">.dark-default-dark {
background-color: #1E1E1E;
color: #D4D4D4;
}

.dark-default-dark .mtk1 { color: #D4D4D4; }
.dark-default-dark .mtk2 { color: #1E1E1E; }
.dark-default-dark .mtk3 { color: #6A9955; }
.dark-default-dark .mtk4 { color: #569CD6; }
.dark-default-dark .mtk5 { color: #D16969; }
.dark-default-dark .mtk6 { color: #D7BA7D; }
.dark-default-dark .mtk7 { color: #B5CEA8; }
.dark-default-dark .mtk8 { color: #CE9178; }
.dark-default-dark .mtk9 { color: #646695; }
.dark-default-dark .mtk10 { color: #4EC9B0; }
.dark-default-dark .mtk11 { color: #DCDCAA; }
.dark-default-dark .mtk12 { color: #9CDCFE; }
.dark-default-dark .mtk13 { color: #000080; }
.dark-default-dark .mtk14 { color: #F44747; }
.dark-default-dark .mtk15 { color: #C586C0; }
.dark-default-dark .mtk16 { color: #6796E6; }
.dark-default-dark .mtk17 { color: #808080; }
.dark-default-dark .mtki { font-style: italic; }
.dark-default-dark .mtkb { font-weight: bold; }
.dark-default-dark .mtku { text-decoration: underline; text-underline-position: under; }</style></div><div class="BlogPageLayout__NonContent-sc-118ribu-1 lkFayL"><div class="EndButtons__Container-sc-2ta1su-0 ArWbr"><a href="https://twitter.com/intent/tweet?text=Post%20by%20%40noahsark769%3A%20Dead%20Simple%20Dependency%20Injection%20in%20Swift%20https%3A%2F%2Fnoahgilmore.com%2Fblog%2Fswift-dependency-injection%2F" target="_blank" aria-label="Twitter" class="default__A-d4l1a1-5 cdDtcW"><div class="EndButtons__ButtonStyle-sc-2ta1su-1 isFShQ"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" size="24" color="white" style="color:white" height="24" width="24"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></div></a><a href="/blog" aria-label="Blog homepage" class="default__A-d4l1a1-5 cdDtcW"><div class="EndButtons__ButtonStyle-sc-2ta1su-1 ikpcIb"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" size="24" color="white" style="color:white" height="24" width="24"><path d="M258.5 104.1c-1.5-1.2-3.5-1.2-5 0l-156 124.8c-.9.8-1.5 1.9-1.5 3.1v230c0 1.1.9 2 2 2h108c1.1 0 2-.9 2-2V322c0-1.1.9-2 2-2h92c1.1 0 2 .9 2 2v140c0 1.1.9 2 2 2h108c1.1 0 2-.9 2-2V232c0-1.2-.6-2.4-1.5-3.1l-156-124.8z"></path><path d="M458.7 204.2l-189-151.4C265.9 49.7 261 48 256 48s-9.9 1.7-13.7 4.8L160 119.7V77.5c0-1.1-.9-2-2-2H98c-1.1 0-2 .9-2 2v92.2l-42.7 35.1c-3.1 2.5-5.1 6.2-5.3 10.2-.2 4 1.3 7.9 4.1 10.7 2.6 2.6 6.1 4.1 9.9 4.1 3.2 0 6.3-1.1 8.8-3.1l183.9-148c.5-.4.9-.4 1.3-.4s.8.1 1.3.4l183.9 147.4c2.5 2 5.6 3.1 8.8 3.1 3.7 0 7.2-1.4 9.9-4.1 2.9-2.8 4.4-6.7 4.2-10.7-.3-4-2.2-7.7-5.4-10.2z"></path></svg></div></a></div><div class="Disqus__Wrapper-sc-1jjeqqj-0 kWZJua"><div id="disqus_thread"></div></div></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/swift-dependency-injection/";window.webpackCompilationHash="ddcb57a94ae07e0a49ba";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-660cc945d02a72283990.js"],"component---src-templates-mdx-blog-posts-jsx":["/component---src-templates-mdx-blog-posts-jsx-fe66687ee51079232074.js"],"component---src-pages-404-jsx":["/component---src-pages-404-jsx-161601fb435f120df7aa.js"],"component---src-pages-blog-index-jsx":["/component---src-pages-blog-index-jsx-2c04e433a97f1459bc27.js"],"component---src-pages-examples-ios-copy-to-clipboard-index-jsx":["/component---src-pages-examples-ios-copy-to-clipboard-index-jsx-2ad886c4e1e387e93158.js"],"component---src-pages-index-jsx":["/component---src-pages-index-jsx-590f1de9f6eed59f4457.js"],"component---src-pages-blog-cfbundleversion-invalid-mdx":["/component---src-pages-blog-cfbundleversion-invalid-mdx-f55f835cf41788f668d4.js"],"component---src-pages-blog-cifilter-colorwheel-mdx":["/component---src-pages-blog-cifilter-colorwheel-mdx-cd04265b32ef53bfc924.js"],"component---src-pages-blog-cifilterio-mdx":["/component---src-pages-blog-cifilterio-mdx-ac5df324517981b09904.js"],"component---src-pages-blog-civector-codable-mdx":["/component---src-pages-blog-civector-codable-mdx-facb277b2cc70c3cb592.js"],"component---src-pages-blog-color-compatibility-pod-mdx":["/component---src-pages-blog-color-compatibility-pod-mdx-7aa130ac79642172dd36.js"],"component---src-pages-blog-dark-mode-uicolor-compatibility-mdx":["/component---src-pages-blog-dark-mode-uicolor-compatibility-mdx-a06e9b0da6bab101210d.js"],"component---src-pages-blog-data-over-the-app-store-mdx":["/component---src-pages-blog-data-over-the-app-store-mdx-0474b26fc2732a7963ec.js"],"component---src-pages-blog-gpu-capture-flickering-mdx":["/component---src-pages-blog-gpu-capture-flickering-mdx-865bb4cd3269b4ee5471.js"],"component---src-pages-blog-catalina-importerror-no-module-named-zlib-mdx":["/component---src-pages-blog-catalina-importerror-no-module-named-zlib-mdx-1b762d7633bae90201f6.js"],"component---src-pages-blog-install-nokogiri-macos-mojave-mdx":["/component---src-pages-blog-install-nokogiri-macos-mojave-mdx-099d63def2db2706de07.js"],"component---src-pages-blog-gatsby-mdx-frontmatter-mdx":["/component---src-pages-blog-gatsby-mdx-frontmatter-mdx-ab4a1c62e3fb97578d87.js"],"component---src-pages-blog-my-bucket-list-mdx":["/component---src-pages-blog-my-bucket-list-mdx-768563506b1e6fd19e2b.js"],"component---src-pages-blog-nsobject-equatable-mdx":["/component---src-pages-blog-nsobject-equatable-mdx-068a222ff7c14cd9958d.js"],"component---src-pages-blog-popover-uinavigationcontroller-preferredcontentsize-mdx":["/component---src-pages-blog-popover-uinavigationcontroller-preferredcontentsize-mdx-01f9f5c49c1ef06de8e2.js"],"component---src-pages-blog-pyparsing-trees-mdx":["/component---src-pages-blog-pyparsing-trees-mdx-2579b31dd93731d2d4f5.js"],"component---src-pages-blog-rxswift-multiple-subscribers-mdx":["/component---src-pages-blog-rxswift-multiple-subscribers-mdx-eed2fd64bb04ad8f2dc3.js"],"component---src-pages-blog-swift-dependency-injection-mdx":["/component---src-pages-blog-swift-dependency-injection-mdx-cf3d8cd610d711020c5a.js"],"component---src-pages-blog-swift-pointer-uint-mdx":["/component---src-pages-blog-swift-pointer-uint-mdx-72b53d73df66f0d2ae2a.js"],"component---src-pages-blog-swiftui-relativedatetimeformatter-mdx":["/component---src-pages-blog-swiftui-relativedatetimeformatter-mdx-966258c6f30e01f0090d.js"],"component---src-pages-blog-tables-are-hard-mdx":["/component---src-pages-blog-tables-are-hard-mdx-ab1e09397cc6328bbf1c.js"],"component---src-pages-blog-taking-down-sfsymbols-mdx":["/component---src-pages-blog-taking-down-sfsymbols-mdx-f1ea3d6520bc4a07d207.js"],"component---src-pages-blog-uibutton-padding-mdx":["/component---src-pages-blog-uibutton-padding-mdx-d8b631526d7a26dc3d89.js"],"component---src-pages-blog-uiwindowscene-black-screen-mdx":["/component---src-pages-blog-uiwindowscene-black-screen-mdx-2b9d33896a2beba70db1.js"],"component---src-pages-blog-userdefaults-set-nil-mdx":["/component---src-pages-blog-userdefaults-set-nil-mdx-e0ed0fc654984f45a14a.js"],"component---src-pages-blog-easy-gatsby-image-components-mdx":["/component---src-pages-blog-easy-gatsby-image-components-mdx-4ac4600457d59f22307e.js"],"component---src-pages-blog-docker-commands-mdx":["/component---src-pages-blog-docker-commands-mdx-488a45a533fba8948aba.js"]};/*]]>*/</script><script src="/component---src-pages-blog-swift-dependency-injection-mdx-cf3d8cd610d711020c5a.js" async=""></script><script src="/2-edfbcd66d0e242a87090.js" async=""></script><script src="/1-d464cbfb3b28ac4f2518.js" async=""></script><script src="/0-e6536100725f44371b25.js" async=""></script><script src="/app-660cc945d02a72283990.js" async=""></script><script src="/webpack-runtime-3cac40ee9ed869cd191e.js" async=""></script></body></html>