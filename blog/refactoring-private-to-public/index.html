<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="stylesheet" href="https://meyerweb.com/eric/tools/css/reset/reset.css"/><meta name="generator" content="Gatsby 2.18.10"/><title data-react-helmet="true">Swift Tip: Refactoring a Private Method for Testability</title><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Roboto:700" rel="stylesheet" type="text/css"/><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Gentium+Book+Basic" rel="stylesheet"/><link data-react-helmet="true" rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.0/styles/atom-one-light.min.css"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@noahsark769"/><meta data-react-helmet="true" property="og:url" content="https://noahgilmore.com/blog/refactoring-private-to-public/"/><meta data-react-helmet="true" property="og:title" content="Swift Tip: Refactoring a Private Method for Testability"/><meta data-react-helmet="true" property="og:description" content="Writing testable Swift code is an ongoing process, so much so that you could write a book about it, but yesterday I was reminded of a really great insight I read long ago in Working Effectively with Legacy Code about testing private methods..."/><meta data-react-helmet="true" name="description" content="Writing testable Swift code is an ongoing process, so much so that you could write a book about it, but yesterday I was reminded of a really great insight I read long ago in Working Effectively with Legacy Code about testing private methods..."/><style data-styled="fbavLQ  dPRTlW ihgmJg kFcWnY jjWRSm dasclg hAFKjM jtmfVw gablWf bDzSYv iQPMaQ cMmljL dTqAlc fjvlYM emBdTA fgyWQq fecpOA eNfbJZ fPVIZy itlfwG jzMaZh dfIsSY" data-styled-version="4.4.1">
/* sc-component-id: Tweet__Wrapper-sc-13ea3j0-0 */
.emBdTA{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}
/* sc-component-id: Tweet__InnerWrapper-sc-13ea3j0-1 */
.fgyWQq{width:1px;min-width:500px;} @media all and (max-width:600px){.fgyWQq{min-width:90%;}}
/* sc-component-id: sc-global-1949001232 */
@font-face{font-family:'Bariol';src:url('/static/Bariol-Regular-b0d07df351f442860551405a4be58de7.eot');src:url('/static/Bariol-Regular-b0d07df351f442860551405a4be58de7.eot?#iefix') format('embedded-opentype'), url('/static/Bariol-Regular-4afd94f0fd93a1f63b46c6c6ad792f71.woff') format('woff'), url('/static/Bariol-Regular-8a7d23d53f8d118e190c63e4e81a91fe.ttf') format('truetype'), url('/static/Bariol-Regular-75b90056f4cdf5a742897ec0a59569d7.svg#svgBariolRegular') format('svg');} *{box-sizing:border-box !important;} body{margin:0;padding:0;} @media (prefers-color-scheme:dark){html,body{background-color:#2b2c2f;}}
/* sc-component-id: default__A-phsh4y-5 */
.fPVIZy,.fPVIZy:hover,.fPVIZy:focus{outline:none;color:inherit;-webkit-text-decoration:none;text-decoration:none;}
/* sc-component-id: Nav__StyledNav-sc-17txzo8-0 */
.dPRTlW{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;padding:20px 60px;border-bottom:1px solid #ddd;} @media all and (max-width:600px){.dPRTlW{padding:20px;}} @media (prefers-color-scheme:dark){.dPRTlW{border-color:#777;}}
/* sc-component-id: Nav__Title-sc-17txzo8-1 */
.ihgmJg{-webkit-flex:2;-ms-flex:2;flex:2;font-family:"Roboto","Helvetica Neue","Helvetica",sans-serif;font-size:28px;font-display:swap;} @media (prefers-color-scheme:dark){.ihgmJg{color:#fff;}}
/* sc-component-id: Nav__NavLinks-sc-17txzo8-2 */
.jjWRSm{margin:0;padding:0;-webkit-flex:10;-ms-flex:10;flex:10;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:horizontal;-ms-flex-direction:horizontal;flex-direction:horizontal;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;height:100%;-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;}
/* sc-component-id: Nav__NavLink-sc-17txzo8-3 */
.dasclg{margin:0;padding:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:vertical;-ms-flex-direction:vertical;flex-direction:vertical;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;text-align:center;font-family:"Bariol","Helvetica Neue","Helvetica",sans-serif;font-size:16px;padding:0px 20px;}
/* sc-component-id: Nav__StyledA-sc-17txzo8-4 */
.kFcWnY{height:auto;color:rgba(128,165,177,1);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:vertical;-ms-flex-direction:vertical;flex-direction:vertical;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:0.2s ease-in-out;-moz-transition:0.2s ease-in-out;-o-transition:0.2s ease-in-out;-webkit-transition:0.2s ease-in-out;transition:0.2s ease-in-out;} .kFcWnY,.kFcWnY:hover,.kFcWnY:focus{outline:none;color:inherit;-webkit-text-decoration:none;text-decoration:none;} .kFcWnY:hover{color:rgba(151,195,210,1);}
/* sc-component-id: BlogPost__BlogPostContainer-tv75ut-0 */
.hAFKjM{padding:60px 0;margin:0 auto;width:90%;} @media all and (min-width:600px){.hAFKjM{max-width:700px;margin:auto;}} @media all and (max-width:600px){.hAFKjM{width:100%;padding:20px 0;}}
/* sc-component-id: BlogPost__TitleContainer-tv75ut-1 */
.iQPMaQ{width:100%;margin-bottom:40px;}
/* sc-component-id: BlogPost__Heading-tv75ut-2 */
.cMmljL{width:100%;font-family:"Roboto","Helvetica Neue","Helvetica",sans-serif;font-size:34px;margin-bottom:10px;line-height:1.2em;} @media (prefers-color-scheme:dark){.cMmljL{color:#fff;}}
/* sc-component-id: BlogPost__DateContainer-tv75ut-3 */
.dTqAlc{font-family:"Gentium Book Basic",times,serif;font-style:italic;font-size:16px;color:#999;}
/* sc-component-id: MarkdownContent__Container-gk8834-0 */
.fjvlYM p,.fjvlYM li{margin:0;padding:0;font-family:"Gentium Book Basic",times,serif;font-size:21px;line-height:29px;color:#333;padding-bottom:15px;margin-top:15px;} @media all and (max-width:600px){.fjvlYM p,.fjvlYM li{width:90%;margin:15px auto 0 auto;}} @media (prefers-color-scheme:dark){.fjvlYM p,.fjvlYM li{color:#fff;}} .fjvlYM blockquote{background-color:#faf9f7;border-left:4px solid #e5e4e1;padding:20px;font-style:italic;} @media (prefers-color-scheme:dark){.fjvlYM blockquote{background-color:#3f3f3f;}} .fjvlYM blockquote p{margin:0;padding:0;color:#555;} @media (prefers-color-scheme:dark){.fjvlYM blockquote p{color:#fff;}} .fjvlYM a{color:#1A3F4B;-webkit-transition:0.2s ease-in-out;-moz-transition:0.2s ease-in-out;-o-transition:0.2s ease-in-out;-webkit-transition:0.2s ease-in-out;transition:0.2s ease-in-out;} @media (prefers-color-scheme:dark){.fjvlYM a{color:#60b5d1;}} .fjvlYM a:hover{color:#47656E;} @media (prefers-color-scheme:dark){.fjvlYM a:hover{color:#6bcfef;}} .fjvlYM code{font-family:monospace;font-size:16px;padding:3px 5px;margin:0px 2px;} @media (prefers-color-scheme:dark){.fjvlYM code{color:#fff;}} .fjvlYM code:not(.vscode-highlight-code){font-family:monospace;font-size:16px;background-color:#faf9f7;border:1px solid #e5e4e1;padding:3px 5px;margin:0px 2px;color:#555;} @media (prefers-color-scheme:dark){.fjvlYM code:not(.vscode-highlight-code){color:#fff;background-color:#3f3f3f;}} .fjvlYM code:first-child{margin-left:0;} .fjvlYM pre{display:block;margin:0;padding:0;margin-top:10px;border:1px solid #e5e4e1;border-radius:2px;} @media all and (max-width:600px){.fjvlYM pre{width:100%;margin:10px auto 0 auto;border-left:none;border-right:none;border-radius:0;overflow-x:scroll;}} .fjvlYM pre > code{display:block;margin:0;padding:10px;font-family:monospace;font-size:14px;line-height:17px;white-space:pre-wrap;} @media all and (max-width:600px){.fjvlYM pre > code{font-size:15px;white-space:pre;padding:15px 5% 15px 5%;width:100%;}} .fjvlYM pre + p{margin-top:30px;} .fjvlYM ol{margin-left:30px;} @media all and (max-width:600px){.fjvlYM ol{width:90%;margin:0 auto 0 30px;}} @media (prefers-color-scheme:dark){.fjvlYM ol{color:#fff;}} .fjvlYM ol li{list-style-type:decimal;} .fjvlYM ul li{list-style-type:square;margin-left:40px;} @media all and (max-width:600px){.fjvlYM ul li{width:90%;margin:0 auto;}} @media (prefers-color-scheme:dark){.fjvlYM ul li{color:#fff;}} .fjvlYM h1,.fjvlYM h2,.fjvlYM h3,.fjvlYM h4,.fjvlYM h5,.fjvlYM h6{width:100%;font-family:"Roboto","Helvetica Neue","Helvetica",sans-serif;margin-bottom:10px;margin-top:40px;} @media all and (max-width:600px){.fjvlYM h1,.fjvlYM h2,.fjvlYM h3,.fjvlYM h4,.fjvlYM h5,.fjvlYM h6{width:90%;margin:40px auto 10px auto;}} @media (prefers-color-scheme:dark){.fjvlYM h1,.fjvlYM h2,.fjvlYM h3,.fjvlYM h4,.fjvlYM h5,.fjvlYM h6{color:#fff;}} .fjvlYM h1{font-size:28px;} .fjvlYM h2{font-size:24px;} .fjvlYM h3{font-size:20px;} .fjvlYM em{font-style:italic;} .fjvlYM strong{font-weight:bold;}
/* sc-component-id: EndButtons__Container-sc-1rt8k5q-0 */
.eNfbJZ{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:horizontal;-ms-flex-direction:horizontal;flex-direction:horizontal;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-top:40px;}
/* sc-component-id: EndButtons__ButtonStyle-sc-1rt8k5q-1 */
.itlfwG{background-color:rgba(128,165,177,1);-webkit-transition:0.2s ease-in-out;-moz-transition:0.2s ease-in-out;-o-transition:0.2s ease-in-out;-webkit-transition:0.2s ease-in-out;transition:0.2s ease-in-out;width:100px;padding:10px 20px;text-align:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:vertical;-ms-flex-direction:vertical;flex-direction:vertical;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:4px;margin-right:20px;} .itlfwG:hover{background-color:rgba(151,195,210,1);}.jzMaZh{background-color:rgba(128,165,177,1);-webkit-transition:0.2s ease-in-out;-moz-transition:0.2s ease-in-out;-o-transition:0.2s ease-in-out;-webkit-transition:0.2s ease-in-out;transition:0.2s ease-in-out;width:100px;padding:10px 20px;text-align:center;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:vertical;-ms-flex-direction:vertical;flex-direction:vertical;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:4px;} .jzMaZh:hover{background-color:rgba(151,195,210,1);}
/* sc-component-id: Disqus__Wrapper-sc-15q2k8t-0 */
.dfIsSY{margin-top:80px;}
/* sc-component-id: BlogPageLayout__Container-sc-1pnb15k-0 */
@media (prefers-color-scheme:dark){.fbavLQ{background-color:#2b2c2f;}}
/* sc-component-id: BlogPageLayout__NonContent-sc-1pnb15k-1 */
@media all and (max-width:600px){.bDzSYv{padding-right:5%;padding-left:5%;}}
/* sc-component-id: BlogPageLayout__PostContainerOuter-sc-1pnb15k-4 */
.jtmfVw{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;padding:0;} @media all and (max-width:1200px){.jtmfVw{padding:0;}}
/* sc-component-id: BlogPageLayout__PostContainerInner-sc-1pnb15k-5 */
.gablWf{display:block;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;}
/* sc-component-id: BlogPageLayout__MyTag-sc-1pnb15k-8 */
.fecpOA{position:relative;} @media all and (min-width:600px){.fecpOA{margin-left:-50px;padding-left:50px;}}</style><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="alternate" type="application/rss+xml" title="Noah Gilmore&#x27;s Development Blog: iOS" href="/blog/ios.xml"/><link rel="alternate" type="application/rss+xml" title="Noah Gilmore&#x27;s Development Blog: Web" href="/blog/web.xml"/><link rel="alternate" type="application/rss+xml" title="Noah Gilmore&#x27;s Development Blog" href="/blog/rss.xml"/><link as="script" rel="preload" href="/webpack-runtime-78bab5932f9a9e8ee80b.js"/><link as="script" rel="preload" href="/app-7f5b598fee27d8595234.js"/><link as="script" rel="preload" href="/commons-45c976dc62b2e82fdfe1.js"/><link as="script" rel="preload" href="/component---src-pages-blog-refactoring-private-to-public-mdx-2c39b58b5b8277bcf941.js"/><link as="fetch" rel="preload" href="/page-data/blog/refactoring-private-to-public/page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="BlogPageLayout__Container-sc-1pnb15k-0 fbavLQ"><nav class="Nav__StyledNav-sc-17txzo8-0 dPRTlW"><div class="Nav__Title-sc-17txzo8-1 ihgmJg"><a href="/blog" class="default__A-phsh4y-5 Nav__StyledA-sc-17txzo8-4 kFcWnY">NOAH GILMORE</a></div><ul class="default__UL-phsh4y-2 Nav__NavLinks-sc-17txzo8-2 jjWRSm"><li class="default__LI-phsh4y-3 Nav__NavLink-sc-17txzo8-3 dasclg"><a aria-label="Blog Home" href="/blog" class="default__A-phsh4y-5 Nav__StyledA-sc-17txzo8-4 kFcWnY"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" color="rgba(128, 165, 177, 1)" size="24" style="color:rgba(128, 165, 177, 1)" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M258.5 104.1c-1.5-1.2-3.5-1.2-5 0l-156 124.8c-.9.8-1.5 1.9-1.5 3.1v230c0 1.1.9 2 2 2h108c1.1 0 2-.9 2-2V322c0-1.1.9-2 2-2h92c1.1 0 2 .9 2 2v140c0 1.1.9 2 2 2h108c1.1 0 2-.9 2-2V232c0-1.2-.6-2.4-1.5-3.1l-156-124.8z"></path><path d="M458.7 204.2l-189-151.4C265.9 49.7 261 48 256 48s-9.9 1.7-13.7 4.8L160 119.7V77.5c0-1.1-.9-2-2-2H98c-1.1 0-2 .9-2 2v92.2l-42.7 35.1c-3.1 2.5-5.1 6.2-5.3 10.2-.2 4 1.3 7.9 4.1 10.7 2.6 2.6 6.1 4.1 9.9 4.1 3.2 0 6.3-1.1 8.8-3.1l183.9-148c.5-.4.9-.4 1.3-.4s.8.1 1.3.4l183.9 147.4c2.5 2 5.6 3.1 8.8 3.1 3.7 0 7.2-1.4 9.9-4.1 2.9-2.8 4.4-6.7 4.2-10.7-.3-4-2.2-7.7-5.4-10.2z"></path></svg></a></li><li class="default__LI-phsh4y-3 Nav__NavLink-sc-17txzo8-3 dasclg"><a aria-label="Twitter" href="https://twitter.com/noahsark769" class="default__A-phsh4y-5 Nav__StyledA-sc-17txzo8-4 kFcWnY"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" color="rgba(128, 165, 177, 1)" size="24" style="color:rgba(128, 165, 177, 1)" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a></li><li class="default__LI-phsh4y-3 Nav__NavLink-sc-17txzo8-3 dasclg"><a aria-label="App Store" href="https://apps.apple.com/us/app/cifilter-io/id1457458557" class="default__A-phsh4y-5 Nav__StyledA-sc-17txzo8-4 kFcWnY"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" color="rgba(128, 165, 177, 1)" size="24" style="color:rgba(128, 165, 177, 1)" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M256 48C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48zm-78.9 296.9c-2.7 4.6-7.5 7.1-12.5 7.1-2.5 0-5-.6-7.3-2-6.9-4-9.2-12.8-5.2-19.7l14.2-23.6c1.5-2.5 4.1-4 7-4h2.1c10.3 0 17.5 6.2 19.6 12.2l-17.9 30zm120.2-46.4l-93 .1h-61.8c-8.2 0-14.8-6.8-14.4-15 .3-7.8 7.1-13.7 14.9-13.7h44.8l53.1-90.4-17.2-29.3c-3.9-6.7-2.2-15.5 4.4-19.7 7-4.5 16.2-2.2 20.3 4.8l9.2 15.7h.1l9.2-15.7c4.1-7 13.4-9.3 20.3-4.8 6.6 4.2 8.3 13 4.4 19.7l-17.2 29.3-16.7 28.5-36.3 61.9v.1h53.5c6.7 0 15.1 3.6 18.5 9.4l.3.6c3 5.1 4.7 8.6 4.7 13.7-.1 2.8-1.1 4.8-1.1 4.8zm72.2.1h-25.2v.1l18.4 31.3c4 6.8 2.1 15.8-4.8 20-2.3 1.4-4.9 2.1-7.5 2.1-5 0-9.8-2.6-12.5-7.1l-27.2-46.3-16.9-28.8-21.8-37.3c-6.4-10.9-6.7-24.5-.6-35.3 4.3-7.6 7.6-9.6 7.6-9.6l48.5 82.1h41.7c7.8 0 14.5 6 14.9 13.7.3 8.3-6.3 15.1-14.6 15.1z"></path></svg></a></li></ul></nav><div class="BlogPost__BlogPostContainer-tv75ut-0 hAFKjM"><div class="BlogPageLayout__PostContainerOuter-sc-1pnb15k-4 jtmfVw"><div class="BlogPageLayout__PostContainerInner-sc-1pnb15k-5 gablWf"><div class="BlogPageLayout__NonContent-sc-1pnb15k-1 bDzSYv"><div><div class="BlogPost__TitleContainer-tv75ut-1 iQPMaQ"><h1 class="BlogPost__Heading-tv75ut-2 cMmljL">Swift Tip: Refactoring a Private Method for Testability</h1><p class="BlogPost__DateContainer-tv75ut-3 dTqAlc">May 28, 2020</p></div></div></div><div class="MarkdownContent__Container-gk8834-0 fjvlYM"><p>Writing testable Swift code is an ongoing process, so much so that you could <a href="https://twitter.com/noahsark769/status/1257347091233374212">write a book about it</a>, but yesterday I was reminded of a really great insight I read long ago in <a href="https://www.oreilly.com/library/view/working-effectively-with/0131177052/">Working Effectively with Legacy Code</a> about testing private methods:</p><div class="Tweet__Wrapper-sc-13ea3j0-0 emBdTA"><div class="Tweet__InnerWrapper-sc-13ea3j0-1 fgyWQq"><div></div></div></div><p>I came across a really great example yesterday where a coworker and I were able to refactor a private method to make it testable. In this post I&#x27;d like to go over that example with the hope that you can apply a similar pattern to make testing your own code easier.</p><blockquote><p>tl;dr: If there&#x27;s a private method you want to test, avoid making it public just to test it - instead, extract it out to a public method on another object.</p></blockquote><h1 id="testing-private-methods" class="BlogPageLayout__MyTag-sc-1pnb15k-8 fecpOA">Testing Private Methods</h1><p>When you&#x27;re writing code, it&#x27;s common to encounter the following scenario: you&#x27;re writing a class which is becoming increasingly complex, and you realize there&#x27;s a private method which is complex enough that you don&#x27;t trust yourself to make sure it works correctly without a test.</p><p>Here&#x27;s a concrete example (code is paraphrased from real production code I reviewed at work). Let&#x27;s say we&#x27;re building an app which manages reports that the user can fill out. There are different report types, and a user can be assigned to a report. We&#x27;re viewing some subset of the reports based on the types and users we&#x27;ve selected, and we want to show stats on our page about how many reports we&#x27;re looking at of each type. In order to configure our view, we have a Store class which provides a ViewModel.</p><p>The code might look something like this:</p><pre class="dark-default-dark vscode-highlight" data-language="swift"><code class="vscode-highlight-code"><span class="vscode-highlight-line"><span class="mtk4">final</span><span class="mtk1"> </span><span class="mtk4">class</span><span class="mtk1"> </span><span class="mtk10">ReportsStore</span><span class="mtk1"> {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk4">private</span><span class="mtk1"> </span><span class="mtk4">var</span><span class="mtk1"> _currentlySelectedUserIds: [</span><span class="mtk10">Int</span><span class="mtk1">]</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk4">private</span><span class="mtk1"> </span><span class="mtk4">var</span><span class="mtk1"> _currentUser: User</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk4">private</span><span class="mtk1"> </span><span class="mtk4">var</span><span class="mtk1"> _seletedTypes: [ReportType]</span></span>
<span class="vscode-highlight-line"><span class="mtk1"></span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk3">// ... initializer and setup omitted ...</span></span>
<span class="vscode-highlight-line"><span class="mtk1"></span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk3">/// - Returns: The number of draft reports of each of the currently</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk3">// selected report types relevant to either the current user id or the</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk3">// users we&#x27;re currently filtering by, keyed by report type</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk4">private</span><span class="mtk1"> </span><span class="mtk4">func</span><span class="mtk1"> </span><span class="mtk11">_getDraftCounts</span><span class="mtk1">() -&gt; [</span><span class="mtk10">Int</span><span class="mtk1">: </span><span class="mtk10">Int</span><span class="mtk1">] {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk4">let</span><span class="mtk1"> userIds = </span><span class="mtk4">self</span><span class="mtk1">.</span><span class="mtk12">_currentlySelectedUserIds</span><span class="mtk1"> + [</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            </span><span class="mtk4">self</span><span class="mtk1">.</span><span class="mtk12">_currentUser</span><span class="mtk1">.</span><span class="mtk12">id</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        ]</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk4">var</span><span class="mtk1"> draftCounts = [[</span><span class="mtk10">Int</span><span class="mtk1">: </span><span class="mtk10">Int</span><span class="mtk1">]]()</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        userIds.</span><span class="mtk11">forEach</span><span class="mtk1"> { userId </span><span class="mtk15">in</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            </span><span class="mtk4">let</span><span class="mtk1"> filter = </span><span class="mtk11">ReportsFilter</span><span class="mtk1">(</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                </span><span class="mtk11">status</span><span class="mtk1">: .</span><span class="mtk12">draft</span><span class="mtk1">,</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                </span><span class="mtk11">userId</span><span class="mtk1">: userId,</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                </span><span class="mtk11">types</span><span class="mtk1">: </span><span class="mtk4">self</span><span class="mtk1">.</span><span class="mtk12">_selectedTypes</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            )</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            </span><span class="mtk15">do</span><span class="mtk1"> {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                </span><span class="mtk4">let</span><span class="mtk1"> draftCount = </span><span class="mtk15">try</span><span class="mtk1"> </span><span class="mtk4">self</span><span class="mtk1">.</span><span class="mtk12">dataRepository</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                    .</span><span class="mtk11">countReportsByType</span><span class="mtk1">(filter)</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                draftCounts.</span><span class="mtk11">append</span><span class="mtk1">(draftCount)</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            } </span><span class="mtk15">catch</span><span class="mtk1"> {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                Logger.</span><span class="mtk12">shared</span><span class="mtk1">.</span><span class="mtk12">error</span><span class="mtk1">(</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                    </span><span class="mtk8">&quot;Error: unable to retrive draft counts&quot;</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                )</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            }</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        }</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk4">let</span><span class="mtk1"> totalCounts = draftCounts</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            .</span><span class="mtk11">flatMap</span><span class="mtk1"> { </span><span class="mtk4">$0</span><span class="mtk1"> }</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            .</span><span class="mtk11">reduce</span><span class="mtk1">([</span><span class="mtk10">Int</span><span class="mtk1">: </span><span class="mtk10">Int</span><span class="mtk1">]()) { dict, tuple </span><span class="mtk15">in</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                </span><span class="mtk4">var</span><span class="mtk1"> nextDict = dict</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                nextDict[tuple.0] = tuple.0</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                </span><span class="mtk15">return</span><span class="mtk1"> nextDict</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            }</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk15">return</span><span class="mtk1"> totalCounts</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    }</span></span>
<span class="vscode-highlight-line"><span class="mtk1"></span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk3">/// - Returns: the view model which our view will use</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk3">/// to configure itself</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk4">public</span><span class="mtk1"> </span><span class="mtk4">func</span><span class="mtk1"> </span><span class="mtk11">viewModel</span><span class="mtk1">() -&gt; ReportsViewModel {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk3">// ... do more work to figure out the other properties</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk3">// of the view model ...</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk11">ReportsViewModel</span><span class="mtk1">(</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            </span><span class="mtk3">// ...</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            </span><span class="mtk11">draftCounts</span><span class="mtk1">: </span><span class="mtk4">self</span><span class="mtk1">.</span><span class="mtk11">_getDraftCounts</span><span class="mtk1">()</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            </span><span class="mtk3">// ...</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        )</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    }</span></span>
<span class="vscode-highlight-line"><span class="mtk1">}</span></span></code></pre><p>The method takes the current state of the store (<code>_currentlySelectedUserIds</code>, <code>_currentUser</code>, <code>_selectedTypes</code>), creates a filter object and passes that to a <code>DataRepository</code> object to actually get the report models. It then processes the report models to create the stats.</p><p>For me, the <code>_getDraftCounts</code> sets off the testing alarm bell. We want to make sure we get the right reports, and we want to make sure the post-processing to create the stats works - it&#x27;s complicated enough that I want to write tests to make sure I didn&#x27;t make a mistake, but figuring out <em>what the best way is</em> to get a test around this isn&#x27;t that easy.</p><h1 id="private-vs-public" class="BlogPageLayout__MyTag-sc-1pnb15k-8 fecpOA">Private vs Public</h1><p>It may be tempting to just expose the <code>_getDraftCounts</code> method as public in order to test it. It&#x27;s less code, after all: no changes required to the actual method, and the test is small:</p><pre class="dark-default-dark vscode-highlight" data-language="swift"><code class="vscode-highlight-code"><span class="vscode-highlight-line"><span class="mtk4">func</span><span class="mtk1"> </span><span class="mtk11">testGetDraftCounts</span><span class="mtk1">() {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> store = </span><span class="mtk11">ReportsStore</span><span class="mtk1">()</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk3">// ... set up the data repository with the right data ...</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk3">// ... set up the store with the right selected types, etc ...</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> draftCounts = store.</span><span class="mtk11">_getDraftCounts</span><span class="mtk1">()</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk11">XCTAssertEqual</span><span class="mtk1">(draftCounts, </span><span class="mtk3">/* ... */</span><span class="mtk1">)</span></span>
<span class="vscode-highlight-line"><span class="mtk1">}</span></span></code></pre><p>But there are a couple of issues with this:</p><ol><li>The setup required to get the <code>ReportsStore</code> into a state where you can test <code>_getDraftCounts</code> is non-trivial. It might be as easy as setting some variables, or it might be as hard as calling a complicated chain of methods. Or worse, you might actually have to expose <em>other</em> private methods as public in order to set the class up for testing!</li><li>It&#x27;s testing the implementation of <code>ReportsStore</code>, not the interface. <code>_getDraftCounts</code> is private because it&#x27;s an implementation detail - no outside consumer (other than the test) is ever going to want to call <code>_getDraftCounts</code> directly. That means that if we want to refactor how the store calculates stats in the future (imagine if we introduced a different model and wanted to include that new model in the stats), the test would break. Having these brittle (easy to break) tests around increases the overhead of maintaining the whole system.</li></ol><h1 id="single-responsibility" class="BlogPageLayout__MyTag-sc-1pnb15k-8 fecpOA">Single Responsibility</h1><p>To understand how to refactor this code so it&#x27;s easier to test, it&#x27;s useful to note that the method has one main dependency: the data repository. The method&#x27;s primary responsibility is to figure out how to query the data repository.</p><p><em>So, why not make the data repository do the work?</em></p><p>If we extract the work do the data repository, the code gets less confusing:</p><pre class="dark-default-dark vscode-highlight" data-language="swift"><code class="vscode-highlight-code"><span class="vscode-highlight-line"><span class="mtk4">extension</span><span class="mtk1"> </span><span class="mtk10">DataRepository</span><span class="mtk1"> {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk4">public</span><span class="mtk1"> </span><span class="mtk4">func</span><span class="mtk1"> </span><span class="mtk11">getDraftCounts</span><span class="mtk1">(</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk11">userIds</span><span class="mtk1">: [</span><span class="mtk10">Int</span><span class="mtk1">],</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk11">types</span><span class="mtk1">: [ReportType]</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    ) -&gt; [</span><span class="mtk10">Int</span><span class="mtk1">: </span><span class="mtk10">Int</span><span class="mtk1">] {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk4">var</span><span class="mtk1"> draftCounts = [[</span><span class="mtk10">Int</span><span class="mtk1">: </span><span class="mtk10">Int</span><span class="mtk1">]]()</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        userIds.</span><span class="mtk11">forEach</span><span class="mtk1"> { userId </span><span class="mtk15">in</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            </span><span class="mtk4">let</span><span class="mtk1"> filter = </span><span class="mtk11">ReportsFilter</span><span class="mtk1">(</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                </span><span class="mtk11">status</span><span class="mtk1">: .</span><span class="mtk12">draft</span><span class="mtk1">,</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                </span><span class="mtk11">userId</span><span class="mtk1">: userId,</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                </span><span class="mtk11">types</span><span class="mtk1">: types</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            )</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            </span><span class="mtk15">do</span><span class="mtk1"> {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                </span><span class="mtk4">let</span><span class="mtk1"> draftCount = </span><span class="mtk15">try</span><span class="mtk1"> </span><span class="mtk4">self</span><span class="mtk1">.</span><span class="mtk11">countReportsByType</span><span class="mtk1">(filter)</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                draftCounts.</span><span class="mtk11">append</span><span class="mtk1">(draftCount)</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            } </span><span class="mtk15">catch</span><span class="mtk1"> {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                Logger.</span><span class="mtk12">shared</span><span class="mtk1">.</span><span class="mtk12">error</span><span class="mtk1">(</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                    </span><span class="mtk8">&quot;Error: unable to retrive draft counts&quot;</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                )</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            }</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        }</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk4">let</span><span class="mtk1"> totalCounts = draftCounts</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            .</span><span class="mtk11">flatMap</span><span class="mtk1"> { </span><span class="mtk4">$0</span><span class="mtk1"> }</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            .</span><span class="mtk11">reduce</span><span class="mtk1">([</span><span class="mtk10">Int</span><span class="mtk1">: </span><span class="mtk10">Int</span><span class="mtk1">]()) { dict, tuple </span><span class="mtk15">in</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                </span><span class="mtk4">var</span><span class="mtk1"> nextDict = dict</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                nextDict[tuple.0] = tuple.0</span></span>
<span class="vscode-highlight-line"><span class="mtk1">                </span><span class="mtk15">return</span><span class="mtk1"> nextDict</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            }</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk15">return</span><span class="mtk1"> totalCounts</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    }</span></span>
<span class="vscode-highlight-line"><span class="mtk1">}</span></span>
<span class="vscode-highlight-line"><span class="mtk1"></span></span>
<span class="vscode-highlight-line"><span class="mtk4">final</span><span class="mtk1"> </span><span class="mtk4">class</span><span class="mtk1"> </span><span class="mtk10">ReportsStore</span><span class="mtk1"> {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk3">// ...</span></span>
<span class="vscode-highlight-line"><span class="mtk1"></span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk4">private</span><span class="mtk1"> </span><span class="mtk4">func</span><span class="mtk1"> </span><span class="mtk11">_getDraftCounts</span><span class="mtk1">() -&gt; [</span><span class="mtk10">Int</span><span class="mtk1">: </span><span class="mtk10">Int</span><span class="mtk1">] {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        </span><span class="mtk15">return</span><span class="mtk1"> </span><span class="mtk4">self</span><span class="mtk1">.</span><span class="mtk12">dataRepository</span><span class="mtk1">.</span><span class="mtk11">getDraftCounts</span><span class="mtk1">(</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            </span><span class="mtk11">userIds</span><span class="mtk1">: </span><span class="mtk4">self</span><span class="mtk1">.</span><span class="mtk12">_currentlySelectedUserIds</span><span class="mtk1"> + [</span><span class="mtk4">self</span><span class="mtk1">.</span><span class="mtk12">_currentUser</span><span class="mtk1">.</span><span class="mtk12">id</span><span class="mtk1">],</span></span>
<span class="vscode-highlight-line"><span class="mtk1">            </span><span class="mtk11">types</span><span class="mtk1">: </span><span class="mtk4">self</span><span class="mtk1">.</span><span class="mtk12">_seletedTypes</span></span>
<span class="vscode-highlight-line"><span class="mtk1">        )</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    }</span></span>
<span class="vscode-highlight-line"><span class="mtk1">}</span></span></code></pre><p>Now that we&#x27;ve extracted the method, we can completely eliminate the need to set up the Store class, and in fact our test won&#x27;t care about the store at all!</p><pre class="dark-default-dark vscode-highlight" data-language="swift"><code class="vscode-highlight-code"><span class="vscode-highlight-line"><span class="mtk4">func</span><span class="mtk1"> </span><span class="mtk11">testGetDraftCounts</span><span class="mtk1">() {</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> repository = </span><span class="mtk11">DataRepository</span><span class="mtk1">()</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk3">// ... set up the data repository with the right data ...</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk4">let</span><span class="mtk1"> draftCounts = repository.</span><span class="mtk11">getDraftCounts</span><span class="mtk1">()</span></span>
<span class="vscode-highlight-line"><span class="mtk1">    </span><span class="mtk11">XCTAssertEqual</span><span class="mtk1">(draftCounts, </span><span class="mtk3">/* ... */</span><span class="mtk1">)</span></span>
<span class="vscode-highlight-line"><span class="mtk1">}</span></span></code></pre><p>Also:</p><ol><li>The implementation of <code>_getDraftCounts</code> in the <code>ReportsStore</code> is free to change or rename itself without this test breaking.</li><li>If another store comes along in the future that wants to use the same counting logic in a different way, only the DataReopsitory needs to be updated, not the <code>ReportsStore</code>.</li><li>If we want to test that <code>ReportsStore</code> calls <code>getDraftCounts</code> with the correct parameters, we can do that in a separate test that injects the <code>DataRepository</code> as an interface.</li><li>The <code>_getDraftCounts</code> function isn&#x27;t exposed on the store, so some other class can&#x27;t violate the store&#x27;s interface by calling it directly.</li><li><code>ReportsStore</code> doesn&#x27;t have to care about constructing a <code>ReportsFilter</code>. If <code>DataRepository</code> wants to stop using a filter object in the future, we&#x27;ll only have to change the <code>DataRepository</code> method, not the <code>ReportsStore</code> method.</li></ol><h1 id="how-do-i-know-when-to-do-this" class="BlogPageLayout__MyTag-sc-1pnb15k-8 fecpOA">How do I know when to do this?</h1><p>This is only one refactoring strategy, and it doesn&#x27;t apply to all cases. However, I usually find that you can apply this if the following are true:</p><ol><li>You have a complicated private method on a large class (like <code>_getDraftCounts</code>)</li><li>The private method has one &quot;main&quot; dependency (like <code>dataRepository.countReportsByType</code>)</li><li>The private method doesn&#x27;t reference <code>self</code> very much.</li></ol><blockquote><p>Note: If the private method doesn&#x27;t reference <code>self</code> as all, then it probably should be a util function, not a method!</p></blockquote><blockquote><p>Also: If the private method doesn&#x27;t just have one main dependency, then you can still apply this strategy, but you&#x27;ll often end up injecting a protocol that includes all of the calls to dependencies that you need, and extracting the method to <em>an extension of that protocol</em> instead of an extension of the main dependency.</p></blockquote><h1 id="faq" class="BlogPageLayout__MyTag-sc-1pnb15k-8 fecpOA">FAQ</h1><h3 id="this-seems-like-a-lot-of-work-id-rather-just-expose-the-private-method-for-testing">This seems like a lot of work, I&#x27;d rather just expose the private method for testing.</h3><p>It&#x27;s true that it&#x27;s more work, but it&#x27;s not <em>that much</em> more work, and it pays off heavily in the long run. Instead of having the <code>ReportsStore</code> with a complicated method which is entangled with the data repository, you now have two separate objects which are independently maintainable and testable, which keeps the code robust as you keep adding to it.</p><h3 id="isnt-this-exposing-too-many-public-methods">Isn&#x27;t this exposing too many public methods?</h3><p>When I tweeted about this, a few people raised concerns to the effect of &quot;sure this works, but you&#x27;re still creating an unnecessary public method&quot;. It&#x27;s true that you&#x27;re creating more public surface area of your API, but it&#x27;s for good reason. </p><p>There are caveats though: in a small app with only one Swift module, everything <code>internal</code> is effectively <code>public</code>, but you control all the consumers of public methods, so it&#x27;s okay to expose more public APIs since you have a handle on what will be calling them.</p><p>This isn&#x27;t the case if you&#x27;re developing a library, or even if you&#x27;re developing a common part of a large app with a large team (in which case, you&#x27;re <em>effectively</em> developing a library). You can still use this refactoring technique, but you&#x27;ll want to extract the code to an internal method rather than a public one. If you&#x27;re working in a very large codebase with only one Swift module, you&#x27;re a bit out of luck as far as compiler safety goes, but you can use other techniques to deter consumers from calling the method directly, like prefixing the method with an underscore, docblocks warning against usage, or linting.</p><h3 id="this-creates-too-many-wrapper-classes-for-no-reason">This creates too many wrapper classes for no reason!</h3><p>If you follow this strategy a lot, you&#x27;ll definitely create more classes than you had before. However, in my experience I&#x27;ve found two things to be true:</p><ol><li>The class which you want to extract the method to usually already exists</li><li>Usually it makes sense for the method to live on that class anyway</li><li>When you do have to create a new class, it feels more like a general utility, not something you need to keep around and frown at just because the tests are forcing you to. You can also declare the class in the same file as the method you extracted it from, or even as a nested class!</li></ol><h3 id="what-about-visiblefortesting">What about VisibleForTesting?</h3><p>Android has a JVM annotation called <a href="https://developer.android.com/reference/androidx/annotation/VisibleForTesting">VisibleForTesting</a> which relaxes visibilty constraints so that you can call private methods in tests. This can be useful for when you&#x27;re developing a library (like mentioned above) and you don&#x27;t want to expose a method publicly, but if you think to yourself &quot;I&#x27;ll just put VisibleForTesting on this method so that I can test it directly&quot;, that&#x27;s very similar to making the method public for testing and subject to many of the same issues.</p><h3 id="what-about-performance">What about performance?</h3><p>At least one person who replied to the tweet was concerned about whether using this strategy results in performance overhead because it&#x27;s slower to have to allocate memory for more objects. I have two thoughts about this:</p><ol><li>Usually you&#x27;ll find this strategy results in a new method in an existing class, not a new class. In all but the most performance-critical code, an extra function call and stack frame won&#x27;t impact anything.</li><li>Be careful not to prematurely optimize for performance. If you notice lagging or performance issues, take the time to profile your code and figure out what the main drivers of the slowness are - almost always, having an additional object allocation won&#x27;t be the issue, but if it is, you can deal with that case when it comes up.</li></ol><h1 id="conclusion" class="BlogPageLayout__MyTag-sc-1pnb15k-8 fecpOA">Conclusion</h1><p>Hopefully this example was a bit more fully fleshed out and gave a better rationale for using this refactoring strategy than can fit in 280 characters. If you&#x27;re interested in more content about Swift refactoring and testing, you can <a href="https://twitter.com/noahsark769">follow me on Twitter</a>.</p><style class="vscode-highlight-styles">
  
  .dark-default-dark {
background-color: #1E1E1E;
color: #D4D4D4;
}

.dark-default-dark .mtk1 { color: #D4D4D4; }
.dark-default-dark .mtk2 { color: #1E1E1E; }
.dark-default-dark .mtk3 { color: #6A9955; }
.dark-default-dark .mtk4 { color: #569CD6; }
.dark-default-dark .mtk5 { color: #D16969; }
.dark-default-dark .mtk6 { color: #D7BA7D; }
.dark-default-dark .mtk7 { color: #B5CEA8; }
.dark-default-dark .mtk8 { color: #CE9178; }
.dark-default-dark .mtk9 { color: #646695; }
.dark-default-dark .mtk10 { color: #4EC9B0; }
.dark-default-dark .mtk11 { color: #DCDCAA; }
.dark-default-dark .mtk12 { color: #9CDCFE; }
.dark-default-dark .mtk13 { color: #000080; }
.dark-default-dark .mtk14 { color: #F44747; }
.dark-default-dark .mtk15 { color: #C586C0; }
.dark-default-dark .mtk16 { color: #6796E6; }
.dark-default-dark .mtk17 { color: #808080; }
.dark-default-dark .mtki { font-style: italic; }
.dark-default-dark .mtkb { font-weight: bold; }
.dark-default-dark .mtku { text-decoration: underline; text-underline-position: under; }
</style></div><div class="BlogPageLayout__NonContent-sc-1pnb15k-1 bDzSYv"><div class="EndButtons__Container-sc-1rt8k5q-0 eNfbJZ"><a href="https://twitter.com/intent/tweet?text=Post%20by%20%40noahsark769%3A%20Swift%20Tip%3A%20Refactoring%20a%20Private%20Method%20for%20Testability%20https%3A%2F%2Fnoahgilmore.com%2Fblog%2Frefactoring-private-to-public%2F" target="_blank" aria-label="Twitter" class="default__A-phsh4y-5 fPVIZy"><div class="EndButtons__ButtonStyle-sc-1rt8k5q-1 itlfwG"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" size="24" color="white" style="color:white" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></div></a><a href="/blog" aria-label="Blog homepage" class="default__A-phsh4y-5 fPVIZy"><div class="EndButtons__ButtonStyle-sc-1rt8k5q-1 jzMaZh"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" size="24" color="white" style="color:white" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M258.5 104.1c-1.5-1.2-3.5-1.2-5 0l-156 124.8c-.9.8-1.5 1.9-1.5 3.1v230c0 1.1.9 2 2 2h108c1.1 0 2-.9 2-2V322c0-1.1.9-2 2-2h92c1.1 0 2 .9 2 2v140c0 1.1.9 2 2 2h108c1.1 0 2-.9 2-2V232c0-1.2-.6-2.4-1.5-3.1l-156-124.8z"></path><path d="M458.7 204.2l-189-151.4C265.9 49.7 261 48 256 48s-9.9 1.7-13.7 4.8L160 119.7V77.5c0-1.1-.9-2-2-2H98c-1.1 0-2 .9-2 2v92.2l-42.7 35.1c-3.1 2.5-5.1 6.2-5.3 10.2-.2 4 1.3 7.9 4.1 10.7 2.6 2.6 6.1 4.1 9.9 4.1 3.2 0 6.3-1.1 8.8-3.1l183.9-148c.5-.4.9-.4 1.3-.4s.8.1 1.3.4l183.9 147.4c2.5 2 5.6 3.1 8.8 3.1 3.7 0 7.2-1.4 9.9-4.1 2.9-2.8 4.4-6.7 4.2-10.7-.3-4-2.2-7.7-5.4-10.2z"></path></svg></div></a></div><div class="Disqus__Wrapper-sc-15q2k8t-0 dfIsSY"><div id="disqus_thread"></div></div></div></div></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/refactoring-private-to-public/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-7f5b598fee27d8595234.js"],"component---src-templates-mdx-blog-posts-jsx":["/component---src-templates-mdx-blog-posts-jsx-1edc92bf3178fea5672c.js"],"component---src-pages-404-jsx":["/component---src-pages-404-jsx-4a15296be80b713f3a9d.js"],"component---src-pages-blog-index-jsx":["/component---src-pages-blog-index-jsx-7275a614d3f6783b4237.js"],"component---src-pages-examples-ios-copy-to-clipboard-index-jsx":["/component---src-pages-examples-ios-copy-to-clipboard-index-jsx-e0fb0d7751876a529613.js"],"component---src-pages-index-jsx":["/component---src-pages-index-jsx-5bdb7db833b8f9339ac1.js"],"component---src-pages-blog-advertising-mdx":["/component---src-pages-blog-advertising-mdx-6041348659d9ad4498a7.js"],"component---src-pages-blog-amplitude-macos-mdx":["/component---src-pages-blog-amplitude-macos-mdx-6bb9459a62344934ce8a.js"],"component---src-pages-blog-catalina-importerror-no-module-named-zlib-mdx":["/component---src-pages-blog-catalina-importerror-no-module-named-zlib-mdx-9a240f4aaf4c12940f89.js"],"component---src-pages-blog-cfbundleversion-invalid-mdx":["/component---src-pages-blog-cfbundleversion-invalid-mdx-68c7ac3888e528fdbddb.js"],"component---src-pages-blog-cifilter-colorwheel-mdx":["/component---src-pages-blog-cifilter-colorwheel-mdx-86a2521c824239922429.js"],"component---src-pages-blog-cifilterio-mdx":["/component---src-pages-blog-cifilterio-mdx-78d21a246a720d45c12f.js"],"component---src-pages-blog-civector-codable-mdx":["/component---src-pages-blog-civector-codable-mdx-c9fcfc96dd60c65bcd70.js"],"component---src-pages-blog-color-compatibility-pod-mdx":["/component---src-pages-blog-color-compatibility-pod-mdx-d11f94b16fc3735f03cd.js"],"component---src-pages-blog-coreanimation-metal-mdx":["/component---src-pages-blog-coreanimation-metal-mdx-ea7266a8cedd79e727a7.js"],"component---src-pages-blog-dark-mode-uicolor-compatibility-mdx":["/component---src-pages-blog-dark-mode-uicolor-compatibility-mdx-04c06e88eec89f150359.js"],"component---src-pages-blog-data-over-the-app-store-mdx":["/component---src-pages-blog-data-over-the-app-store-mdx-df1b5e848ea63a4cc296.js"],"component---src-pages-blog-didprocessediting-crash-mdx":["/component---src-pages-blog-didprocessediting-crash-mdx-993b6753c2d0a7b6c454.js"],"component---src-pages-blog-docker-commands-mdx":["/component---src-pages-blog-docker-commands-mdx-d7d61292682db187559a.js"],"component---src-pages-blog-easy-gatsby-image-components-mdx":["/component---src-pages-blog-easy-gatsby-image-components-mdx-d602adc6b97444b1edeb.js"],"component---src-pages-blog-gatsby-mdx-frontmatter-mdx":["/component---src-pages-blog-gatsby-mdx-frontmatter-mdx-e4d1f3eab57f2dc164fd.js"],"component---src-pages-blog-gatsby-tailwind-mdx":["/component---src-pages-blog-gatsby-tailwind-mdx-1e3c1923cdd54e78dcb1.js"],"component---src-pages-blog-gpu-capture-flickering-mdx":["/component---src-pages-blog-gpu-capture-flickering-mdx-cd138fa4935b6fea3808.js"],"component---src-pages-blog-install-nokogiri-macos-mojave-mdx":["/component---src-pages-blog-install-nokogiri-macos-mojave-mdx-1e9735225dd9861d9b3f.js"],"component---src-pages-blog-installing-sharp-github-actions-mdx":["/component---src-pages-blog-installing-sharp-github-actions-mdx-010088c678b599dfef77.js"],"component---src-pages-blog-my-bucket-list-mdx":["/component---src-pages-blog-my-bucket-list-mdx-3c04594610d7f800b26e.js"],"component---src-pages-blog-nesting-property-wrappers-mdx":["/component---src-pages-blog-nesting-property-wrappers-mdx-dbb9aa96004bca39be48.js"],"component---src-pages-blog-nsobject-equatable-mdx":["/component---src-pages-blog-nsobject-equatable-mdx-7b976156e3af8bda5d29.js"],"component---src-pages-blog-nstextview-shift-tab-mdx":["/component---src-pages-blog-nstextview-shift-tab-mdx-91e2ba34cc0738a59301.js"],"component---src-pages-blog-popover-uinavigationcontroller-preferredcontentsize-mdx":["/component---src-pages-blog-popover-uinavigationcontroller-preferredcontentsize-mdx-2d9f575f6aadb3f15968.js"],"component---src-pages-blog-pyparsing-trees-mdx":["/component---src-pages-blog-pyparsing-trees-mdx-43b7c00dbd33533c8ad3.js"],"component---src-pages-blog-refactoring-private-to-public-mdx":["/component---src-pages-blog-refactoring-private-to-public-mdx-2c39b58b5b8277bcf941.js"],"component---src-pages-blog-rxswift-multiple-subscribers-mdx":["/component---src-pages-blog-rxswift-multiple-subscribers-mdx-e21686f15d7bec06e387.js"],"component---src-pages-blog-swift-dependency-injection-mdx":["/component---src-pages-blog-swift-dependency-injection-mdx-7669edabdef712802a80.js"],"component---src-pages-blog-swift-pointer-uint-mdx":["/component---src-pages-blog-swift-pointer-uint-mdx-b64993f44326bcd7dedd.js"],"component---src-pages-blog-swiftui-relativedatetimeformatter-mdx":["/component---src-pages-blog-swiftui-relativedatetimeformatter-mdx-fdca34afb9551ed94b5b.js"],"component---src-pages-blog-tables-are-hard-mdx":["/component---src-pages-blog-tables-are-hard-mdx-7dc7dbd218cd087a79a8.js"],"component---src-pages-blog-taking-down-sfsymbols-mdx":["/component---src-pages-blog-taking-down-sfsymbols-mdx-e21f280117ea27193e04.js"],"component---src-pages-blog-uibutton-padding-mdx":["/component---src-pages-blog-uibutton-padding-mdx-615d28871b68998dd2fa.js"],"component---src-pages-blog-uiwindowscene-black-screen-mdx":["/component---src-pages-blog-uiwindowscene-black-screen-mdx-3ff84264403cb7ae2e6f.js"],"component---src-pages-blog-userdefaults-editor-swiftui-mdx":["/component---src-pages-blog-userdefaults-editor-swiftui-mdx-eb38dad1a58ec7ccc9d4.js"],"component---src-pages-blog-userdefaults-set-nil-mdx":["/component---src-pages-blog-userdefaults-set-nil-mdx-323991ba5ba291606ca2.js"]};/*]]>*/</script><script src="/component---src-pages-blog-refactoring-private-to-public-mdx-2c39b58b5b8277bcf941.js" async=""></script><script src="/commons-45c976dc62b2e82fdfe1.js" async=""></script><script src="/app-7f5b598fee27d8595234.js" async=""></script><script src="/webpack-runtime-78bab5932f9a9e8ee80b.js" async=""></script></body></html>